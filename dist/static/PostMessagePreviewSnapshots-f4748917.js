import{$ as l,a0 as w,r as o,bf as P,b6 as g,c8 as _,bO as S,c9 as x,ca as E,cb as M,bQ as k,b5 as m,c7 as $,aj as j,cc as y}from"./sanity-66341ca1.js";function D(u){return l(function(p,a){var r=!1,i=0;p.subscribe(w(a,function(e){return(r||(r=!u(e,i++)))&&a.next(e)}))})}const O=u=>{const{comlink:p,refs:a,perspective:r}=u,i=P(),e=g(),c=o.useMemo(()=>new _,[]),d=o.useMemo(()=>c.asObservable().pipe(S(b=>x(b.map(s=>{const t={...s,_id:E(s._id)},n=r==="previewDrafts"?i.observeForPreview(t,e.get(t._type)).pipe(M(),D(v=>v.snapshot===null)):k,f={...s,_id:m(s._id)},h=i.observeForPreview(f,e.get(f._type));return $(h.pipe(j(n)),n)}))),y(0)),[i,c,e,r]);return o.useEffect(()=>{const b=d.subscribe(s=>{p.post({type:"presentation/preview-snapshots",data:{snapshots:s.filter(t=>t.snapshot).map(t=>{const n=t.snapshot;return{...n,_id:m(n._id)}})}})});return()=>{b.unsubscribe()}},[p,d]),o.useEffect(()=>{c.next(a)},[a,c]),null};var F=o.memo(O);export{F as default};
