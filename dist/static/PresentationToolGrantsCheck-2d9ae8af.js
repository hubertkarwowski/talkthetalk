var dr=Object.defineProperty;var pr=(e,t,n)=>t in e?dr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Gt=(e,t,n)=>(pr(e,typeof t!="symbol"?t+"":t,n),n);import{X as hr,r as c,Y as Bt,Z as fr,$ as mr,a0 as gr,a1 as Be,a2 as vr,a3 as gn,a4 as vn,a5 as He,a6 as ot,a7 as Se,a8 as J,a9 as ye,aa as yr,ab as xr,ac as ct,ad as Xe,ae as yn,af as ut,ag as br,ah as lt,ai as wr,aj as Pr,ak as jr,al as Sr,am as xn,f as B,j as o,an as De,ao as Pe,ap as Z,n as Re,T as O,k as ee,aq as te,i as bn,u as $e,ar as ze,as as vt,at as wn,B as H,au as Er,av as Pn,G as kr,t as ce,aw as jn,o as N,S as Y,C as F,ax as Sn,ay as Cr,az as dt,w as _r,F as $,aA as yt,aB as Rr,aC as Ht,aD as Tr,aE as Ir,aF as Ar,aG as Or,aH as Mr,aI as Xt,aJ as Dr,aK as $r,p as Te,m as Ie,a as zr,I as Lr,aL as Ur,aM as En,aN as Nr,s as Wr,aO as qr,aP as Fr,aQ as Vr,aR as kn,aS as Cn,aT as Kr,aU as Gr,aV as xt,aW as _n,aX as Br,aY as Hr,aZ as Xr,a_ as Jr,a$ as Qr,b0 as Yr,b1 as Zr,b2 as es,b3 as ts,b4 as ns,b5 as bt,b6 as rs,b7 as ss,b8 as is,b9 as as,ba as os,z as cs,bb as us,bc as Rn,bd as Tn,be as ls,bf as ds,bg as ps,bh as hs,bi as fs,bj as ms}from"./sanity-66341ca1.js";import{i as gs,D as vs}from"./DisplayedDocumentBroadcaster-7ca8062e.js";function ys({children:e,isValidProp:t,...n}){t&&hr(t),n={...c.useContext(Bt),...n},n.isStatic=fr(()=>n.isStatic);const r=c.useMemo(()=>n,[JSON.stringify(n.transition),n.transformPagePoint,n.reducedMotion]);return c.createElement(Bt.Provider,{value:r},e)}function xs(e,t){return t===void 0&&(t=null),t=t??e,mr(function(n,r){var i=[],s=0;n.subscribe(gr(r,function(a){var l,u,d,f,p=null;s++%t===0&&i.push([]);try{for(var m=Be(i),h=m.next();!h.done;h=m.next()){var g=h.value;g.push(a),e<=g.length&&(p=p??[],p.push(g))}}catch(x){l={error:x}}finally{try{h&&!h.done&&(u=m.return)&&u.call(m)}finally{if(l)throw l.error}}if(p)try{for(var y=Be(p),b=y.next();!b.done;b=y.next()){var g=b.value;vr(i,g),r.next(g)}}catch(x){d={error:x}}finally{try{b&&!b.done&&(f=y.return)&&f.call(y)}finally{if(d)throw d.error}}},function(){var a,l;try{for(var u=Be(i),d=u.next();!d.done;d=u.next()){var f=d.value;r.next(f)}}catch(p){a={error:p}}finally{try{d&&!d.done&&(l=u.return)&&l.call(u)}finally{if(a)throw a.error}}r.complete()},void 0,function(){i=null}))})}const wt="sanity.previewUrlSecret",bs="sanity-preview-url-secret",re=`${bs}.share-access`,ue="sanity.previewUrlShareAccess",Pt="2023-11-09",jt="sanity-preview-secret",St="sanity-preview-pathname",Et="sanity-preview-perspective",In=60*60,ws=`*[_id == "${re}" && _type == "${ue}"][0].secret`,Ps=`*[_type == "${wt}" && dateTime(_updatedAt) <= dateTime(now()) - ${In}]`,kt="sanity.preview-url-secret";var L=[];for(var Je=0;Je<256;++Je)L.push((Je+256).toString(16).slice(1));function js(e,t=0){return(L[e[t+0]]+L[e[t+1]]+L[e[t+2]]+L[e[t+3]]+"-"+L[e[t+4]]+L[e[t+5]]+"-"+L[e[t+6]]+L[e[t+7]]+"-"+L[e[t+8]]+L[e[t+9]]+"-"+L[e[t+10]]+L[e[t+11]]+L[e[t+12]]+L[e[t+13]]+L[e[t+14]]+L[e[t+15]]).toLowerCase()}var Ee,Ss=new Uint8Array(16);function Es(){if(!Ee&&(Ee=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ee))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ee(Ss)}var ks=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Jt={randomUUID:ks};function be(e,t,n){if(Jt.randomUUID&&!t&&!e)return Jt.randomUUID();e=e||{};var r=e.random||(e.rng||Es)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return js(r)}const Qt=e=>({context:t})=>{const{count:n,include:r,exclude:i,responseType:s="message.received"}=e;return{count:n,domain:t.domain,from:t.connectTo,include:r?Array.isArray(r)?r:[r]:[],exclude:i?Array.isArray(i)?i:[i]:[],responseType:s,target:t.target,to:t.name}},Cs=jr(()=>lt(window,"message")),An=e=>gn(({input:t})=>{return Cs.pipe(e?ct(e):Xe(),yn((r=>i=>{const{data:s}=i;return(!r.include.length||r.include.includes(s.type))&&(!r.exclude.length||!r.exclude.includes(s.type))&&s.domain===r.domain&&s.from===r.from&&s.to===r.to&&(!r.target||i.source===r.target)})(t)),ct((n=t.responseType,r=>({type:n,message:r}))),t.count?Xe(xs(t.count),br(r=>r),ut(t.count)):Xe());var n}),Ct="sanity/comlink",we="comlink/response",Ae="comlink/heartbeat",_t="comlink/disconnect",Rt="comlink/handshake/syn",Tt="comlink/handshake/syn-ack",It="comlink/handshake/ack",On=()=>vn({types:{},actors:{listen:gn(({input:e})=>{const t=e.signal?lt(e.signal,"abort").pipe((n=`Request ${e.requestId} aborted`,r=>r.pipe(ut(1),ct(()=>{throw new Error(n)})))):wr;var n;return lt(window,"message").pipe(yn(r=>{var i,s;return((i=r.data)==null?void 0:i.type)===we&&((s=r.data)==null?void 0:s.responseTo)===e.requestId&&!!r.source&&e.sources.has(r.source)}),ut(e.sources.size),Pr(t))})},actions:{"send message":({context:e},t)=>{const{sources:n,targetOrigin:r}=e,{message:i}=t;n.forEach(s=>{s.postMessage(i,{targetOrigin:r})})},"on success":He(({context:e})=>e.parentRef,({context:e,self:t})=>{var n;return e.response&&((n=e.resolvable)==null||n.resolve(e.response)),{type:"request.success",requestId:t.id,response:e.response,responseTo:e.responseTo}}),"on fail":He(({context:e})=>e.parentRef,({context:e,self:t})=>{var n;return console.warn(`Received no response to message '${e.type}' on client '${e.from}' (ID: '${e.id}').`),(n=e.resolvable)==null||n.reject(new Error("No response received")),{type:"request.failed",requestId:t.id}}),"on abort":He(({context:e})=>e.parentRef,({context:e,self:t})=>{var n;return(n=e.resolvable)==null||n.reject(new Error("Request aborted")),{type:"request.aborted",requestId:t.id}})},guards:{expectsResponse:({context:e})=>e.expectResponse},delays:{initialTimeout:0,responseTimeout:1e4}}).createMachine({context:({input:e})=>({connectionId:e.connectionId,data:e.data,domain:e.domain,expectResponse:e.expectResponse??!1,from:e.from,id:`msg-${be()}`,parentRef:e.parentRef,resolvable:e.resolvable,response:null,responseTo:e.responseTo,signal:e.signal,sources:e.sources instanceof Set?e.sources:new Set([e.sources]),targetOrigin:e.targetOrigin,to:e.to,type:e.type}),initial:"idle",on:{abort:".aborted"},states:{idle:{after:{initialTimeout:[{target:"sending"}]}},sending:{entry:{type:"send message",params:({context:e})=>{const{connectionId:t,data:n,domain:r,from:i,id:s,responseTo:a,to:l,type:u}=e;return{message:{connectionId:t,data:n,domain:r,from:i,id:s,to:l,type:u,responseTo:a}}}},always:[{guard:"expectsResponse",target:"awaiting"},"success"]},awaiting:{invoke:{id:"listen for response",src:"listen",input:({context:e})=>({requestId:e.id,sources:e.sources,signal:e.signal}),onError:"aborted"},after:{responseTimeout:"failed"},on:{message:{actions:ot({response:({event:e})=>e.data.data,responseTo:({event:e})=>e.data.responseTo}),target:"success"}}},failed:{type:"final",entry:"on fail"},success:{type:"final",entry:"on success"},aborted:{type:"final",entry:"on abort"}},output:({context:e,self:t})=>({requestId:t.id,response:e.response,responseTo:e.responseTo})}),_s=xr(({sendBack:e,input:t})=>{const n=()=>{e(t.event)};t.immediate&&n();const r=setInterval(n,t.interval);return()=>{clearInterval(r)}}),Oe=()=>vn({types:{},actors:{requestMachine:On(),listen:An(),sendBackAtInterval:_s},actions:{"buffer message":Se(({enqueue:e})=>{e.assign({buffer:({event:t,context:n})=>(J(t,"post"),[...n.buffer,t.data])}),e.emit(({event:t})=>(J(t,"post"),{type:"_buffer.added",message:t.data}))}),"create request":ot({requests:({context:e,event:t,self:n,spawn:r})=>{J(t,"request");const i=(Array.isArray(t.data)?t.data:[t.data]).map(s=>{const a=`req-${be()}`;return r("requestMachine",{id:a,input:{connectionId:e.connectionId,data:s.data,domain:e.domain,expectResponse:s.expectResponse,from:e.name,parentRef:n,responseTo:s.responseTo,sources:e.target,targetOrigin:e.targetOrigin,to:e.connectTo,type:s.type}})});return[...e.requests,...i]}}),"emit received message":Se(({enqueue:e})=>{e.emit(({event:t})=>(J(t,"message.received"),{type:"_message",message:t.message.data})),e.emit(({event:t})=>(J(t,"message.received"),{type:t.message.data.type,message:t.message.data}))}),"flush buffer":Se(({enqueue:e})=>{e.raise(({context:t})=>({type:"request",data:t.buffer.map(({data:n,type:r})=>({data:n,type:r}))})),e.emit(({context:t})=>({type:"_buffer.flushed",messages:t.buffer})),e.assign({buffer:[]})}),post:ye(({event:e})=>(J(e,"post"),{type:"request",data:{data:e.data.data,expectResponse:!0,type:e.data.type}})),"remove request":Se(({context:e,enqueue:t,event:n})=>{J(n,["request.success","request.failed","request.aborted"]),yr(n.requestId),t.assign({requests:e.requests.filter(({id:r})=>r!==n.requestId)})}),respond:ye(({event:e})=>(J(e,"response"),{type:"request",data:{data:e.data,type:we,responseTo:e.respondTo}})),"send handshake ack":ye({type:"request",data:{type:It}}),"send disconnect":ye(()=>({type:"request",data:{type:_t}})),"send handshake syn":ye({type:"request",data:{type:Rt}}),"set target":ot({target:({event:e})=>(J(e,"target.set"),e.target)})},guards:{"has target":({context:e})=>!!e.target,"should send heartbeats":({context:e})=>e.heartbeat}}).createMachine({id:"channel",context:({input:e})=>({id:e.id||`${e.name}-${be()}`,buffer:[],connectionId:`cnx-${be()}`,connectTo:e.connectTo,domain:e.domain??Ct,heartbeat:e.heartbeat??!1,name:e.name,requests:[],target:e.target,targetOrigin:e.targetOrigin}),on:{"target.set":{actions:"set target"},"request.success":{actions:"remove request"},"request.failed":{actions:"remove request"}},initial:"idle",states:{idle:{on:{connect:{target:"handshaking",guard:"has target"},post:{actions:"buffer message"}}},handshaking:{id:"handshaking",invoke:[{id:"send syn",src:"sendBackAtInterval",input:()=>({event:{type:"syn"},interval:500,immediate:!0})},{id:"listen for handshake",src:"listen",input:e=>Qt({include:Tt,count:1})(e)}],on:{syn:{actions:"send handshake syn"},request:{actions:"create request"},post:{actions:"buffer message"},"message.received":{target:"connected"},disconnect:{target:"disconnected"}},exit:"send handshake ack"},connected:{entry:"flush buffer",invoke:{id:"listen for messages",src:"listen",input:Qt({exclude:[we,Ae]})},on:{post:{actions:"post"},request:{actions:"create request"},response:{actions:"respond"},"message.received":{actions:"emit received message"},disconnect:{target:"disconnected"}},initial:"heartbeat",states:{heartbeat:{initial:"checking",states:{checking:{always:{guard:"should send heartbeats",target:"sending"}},sending:{on:{"request.failed":{target:"#handshaking"}},invoke:{id:"send heartbeat",src:"sendBackAtInterval",input:()=>({event:{type:"post",data:{type:Ae,data:void 0}},interval:2e3,immediate:!1})}}}}}},disconnected:{id:"disconnected",entry:"send disconnect",on:{request:{actions:"create request"},post:{actions:"buffer message"},connect:{target:"handshaking",guard:"has target"}}}}}),Qe=(e,t=Oe())=>{const n=e.id||`${e.name}-${be()}`,r=Sr(t,{input:{...e,id:n}}),i=()=>{r.stop()};return{actor:r,connect:()=>{r.send({type:"connect"})},disconnect:()=>{r.send({type:"disconnect"})},id:n,name:e.name,machine:t,on:(s,a)=>{const{unsubscribe:l}=r.on(s,async u=>{const d=await a(u.message.data);d&&r.send({type:"response",respondTo:u.message.id,data:d})});return l},onStatus:s=>{const a=r.getSnapshot();let l=typeof a.value=="string"?a.value:Object.keys(a.value)[0];const{unsubscribe:u}=r.subscribe(d=>{const f=typeof d.value=="string"?d.value:Object.keys(d.value)[0];l!==f&&(l=f,s(f))});return u},post:s=>{r.send({type:"post",data:s})},setTarget:s=>{r.send({type:"target.set",target:s})},start:()=>(r.start(),i),stop:i,get target(){return r.getSnapshot().context.target}}},Rs=()=>{},Ts=e=>{const{targetOrigin:t}=e,n=new Set,r=new Set,i=s=>{s.disconnect(),setTimeout(()=>{s.stop()},0)};return{addTarget:s=>{if(n.has(s))return Rs;if(!n.size||!r.size)return n.add(s),r.forEach(l=>{l.channels.forEach(u=>{u.setTarget(s),u.connect()})}),()=>{n.delete(s),r.forEach(l=>{l.channels.forEach(u=>{u.target===s&&u.disconnect()})})};n.add(s);const a=new Set;return r.forEach(l=>{const u=Qe({...l.input,target:s,targetOrigin:t},l.machine);a.add(u),l.channels.add(u),l.subscribers.forEach(({type:d,handler:f,unsubscribers:p})=>{p.push(u.on(d,f))}),l.internalEventSubscribers.forEach(({type:d,handler:f,unsubscribers:p})=>{p.push(u.actor.on(d,f).unsubscribe)}),l.statusSubscribers.forEach(({handler:d,unsubscribers:f})=>{f.push(u.onStatus(p=>d({channel:u.id,status:p})))}),u.start(),u.connect()}),()=>{n.delete(s),a.forEach(l=>{i(l),r.forEach(u=>{u.channels.delete(l)})})}},createConnection:(s,a=Oe())=>{const l={channels:new Set,input:s,internalEventSubscribers:new Set,machine:a,statusSubscribers:new Set,subscribers:new Set};r.add(l);const{channels:u,internalEventSubscribers:d,statusSubscribers:f,subscribers:p}=l;if(n.size)n.forEach(h=>{const g=Qe({...s,target:h,targetOrigin:t},a);u.add(g)});else{const h=Qe({...s,targetOrigin:t},a);u.add(h)}const m=()=>{u.forEach(h=>{h.disconnect(),h.stop()})};return{on:(h,g)=>{const y=[];u.forEach(x=>{y.push(x.on(h,g))});const b={type:h,handler:g,unsubscribers:y};return p.add(b),()=>{y.forEach(x=>x()),p.delete(b)}},onInternalEvent:(h,g)=>{const y=[];u.forEach(x=>{y.push(x.actor.on(h,g).unsubscribe)});const b={type:h,handler:g,unsubscribers:y};return d.add(b),()=>{y.forEach(x=>x()),d.delete(b)}},onStatus:h=>{const g=[];u.forEach(b=>{g.push(b.onStatus(x=>h({channel:b.id,status:x})))});const y={handler:h,unsubscribers:g};return f.add(y),()=>{g.forEach(b=>b()),f.delete(y)}},post:h=>{u.forEach(g=>{g.post(h)})},start:()=>(u.forEach(h=>{h.start(),h.connect()}),m),stop:m}},destroy:()=>{r.forEach(({channels:s})=>{s.forEach(a=>{i(a),s.delete(a)})})}}},Is=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,At=/_key\s*==\s*['"](.*)['"]/,As=/^\d*:\d*$/;function Ot(e){return typeof e=="number"||typeof e=="string"&&/^\[\d+\]$/.test(e)}function Le(e){return typeof e=="string"?At.test(e.trim()):typeof e=="object"&&"_key"in e}function Mn(e){if(typeof e=="string"&&As.test(e))return!0;if(!Array.isArray(e)||e.length!==2)return!1;const[t,n]=e;return(typeof t=="number"||t==="")&&(typeof n=="number"||n==="")}function Os(e,t,n){const r=typeof t=="string"?Dn(t):t;if(!Array.isArray(r))throw new Error("Path must be an array or a string");let i=e;for(let s=0;s<r.length;s++){const a=r[s];if(Ot(a)){if(!Array.isArray(i))return n;i=i[a]}if(Le(a)){if(!Array.isArray(i))return n;i=i.find(l=>l._key===a._key)}if(typeof a=="string"&&(i=typeof i=="object"&&i!==null?i[a]:void 0),typeof i>"u")return n}return i}function Ms(e){if(!Array.isArray(e))throw new Error("Path is not an array");return e.reduce((t,n,r)=>{const i=typeof n;if(i==="number")return`${t}[${n}]`;if(i==="string")return`${t}${r===0?"":"."}${n}`;if(Le(n)&&n._key)return`${t}[_key=="${n._key}"]`;if(Array.isArray(n)){const[s,a]=n;return`${t}[${s}:${a}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(n)}\``)},"")}function Dn(e){if(typeof e!="string")throw new Error("Path is not a string");const t=e.match(Is);if(!t)throw new Error("Invalid path string");return t.map(Ds)}function Ds(e){return Ot(e)?$s(e):Le(e)?zs(e):Mn(e)?Ls(e):e}function $s(e){return Number(e.replace(/[^\d]/g,""))}function zs(e){return{_key:e.match(At)[1]}}function Ls(e){const[t,n]=e.split(":").map(r=>r===""?r:Number(r));return[t,n]}var $n=Object.freeze({__proto__:null,fromString:Dn,get:Os,isIndexSegment:Ot,isIndexTuple:Mn,isKeySegment:Le,reKeySegment:At,toString:Ms});const Yt="drafts.";function co(e){return e.startsWith(Yt)?e.slice(Yt.length):e}const Zt={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},en={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function Us(e){return`$${e.map(t=>typeof t=="string"?`['${t.replace(/[\f\n\r\t'\\]/g,n=>Zt[n])}']`:typeof t=="number"?`[${t}]`:t._key!==""?`[?(@._key=='${t._key.replace(/['\\]/g,n=>Zt[n])}')]`:`[${t._index}]`).join("")}`}function uo(e){const t=[],n=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let r;for(;(r=n.exec(e))!==null;){if(r[1]!==void 0){const i=r[1].replace(/\\(\\|f|n|r|t|')/g,s=>en[s]);t.push(i);continue}if(r[2]!==void 0){t.push(parseInt(r[2],10));continue}if(r[3]!==void 0){const i=r[3].replace(/\\(\\')/g,s=>en[s]);t.push({_key:i,_index:-1});continue}}return t}function Ns(e){return e.map(t=>{if(typeof t=="string"||typeof t=="number")return t;if(t._index!==-1)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)})}function lo(e,t){if(!(t!=null&&t.mappings))return;const n=Us(Ns(e));if(t.mappings[n]!==void 0)return{mapping:t.mappings[n],matchedPath:n,pathSuffix:""};const r=Object.entries(t.mappings).filter(([l])=>n.startsWith(l)).sort(([l],[u])=>u.length-l.length);if(r.length==0)return;const[i,s]=r[0],a=n.substring(i.length);return{mapping:s,matchedPath:i,pathSuffix:a}}function Ws(e){return e!==null&&Array.isArray(e)}function tn(e){return typeof e=="object"&&e!==null}function Ye(e,t,n=[]){return Ws(e)?e.map((r,i)=>{if(tn(r)){const s=r._key;if(typeof s=="string")return Ye(r,t,n.concat({_key:s,_index:i}))}return Ye(r,t,n.concat(i))}):tn(e)?Object.fromEntries(Object.entries(e).map(([r,i])=>[r,Ye(i,t,n.concat(r))])):t(e,n)}function qs(e){const t=new URL(e),{searchParams:n}=t;return n.delete(St),n.delete(jt),n.delete(Et),t}function Fs(e,t,n,r){const i=new URL(e),{searchParams:s}=i;return s.set(jt,t),s.set(St,n),s.set(Et,r),i}function zn(){if(typeof crypto<"u"){const e=new Uint8Array(16);crypto.getRandomValues(e);let t="";for(let n=0;n<e.length;n++)t+=e[n].toString(16).padStart(2,"0");return t=btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]+$/,""),t}return Math.random().toString(36).slice(2)}async function Vs(e,t,n,r){const i=e.withConfig({apiVersion:Pt}),s=zn(),a=i.patch(re).set({secret:s,studioUrl:n,userId:r});return await i.transaction().createIfNotExists({_id:re,_type:ue,source:t,studioUrl:n,userId:r}).patch(a).commit({tag:kt}),{secret:s}}async function Ks(e,t,n,r){const i=e.withConfig({apiVersion:Pt}),s=i.patch(re).set({secret:null,studioUrl:n,userId:r});await i.transaction().createIfNotExists({_id:re,_type:ue,source:t,studioUrl:n,userId:r}).patch(s).commit({tag:kt})}function Gs(e){for(var t=[],n=0;n<e.length;){var r=e[n];if(r==="*"||r==="+"||r==="?"){t.push({type:"MODIFIER",index:n,value:e[n++]});continue}if(r==="\\"){t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});continue}if(r==="{"){t.push({type:"OPEN",index:n,value:e[n++]});continue}if(r==="}"){t.push({type:"CLOSE",index:n,value:e[n++]});continue}if(r===":"){for(var i="",s=n+1;s<e.length;){var a=e.charCodeAt(s);if(a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||a===95){i+=e[s++];continue}break}if(!i)throw new TypeError("Missing parameter name at ".concat(n));t.push({type:"NAME",index:n,value:i}),n=s;continue}if(r==="("){var l=1,u="",s=n+1;if(e[s]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(s));for(;s<e.length;){if(e[s]==="\\"){u+=e[s++]+e[s++];continue}if(e[s]===")"){if(l--,l===0){s++;break}}else if(e[s]==="("&&(l++,e[s+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(s));u+=e[s++]}if(l)throw new TypeError("Unbalanced pattern at ".concat(n));if(!u)throw new TypeError("Missing pattern at ".concat(n));t.push({type:"PATTERN",index:n,value:u}),n=s;continue}t.push({type:"CHAR",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}function Bs(e,t){t===void 0&&(t={});for(var n=Gs(e),r=t.prefixes,i=r===void 0?"./":r,s=t.delimiter,a=s===void 0?"/#?":s,l=[],u=0,d=0,f="",p=function(A){if(d<n.length&&n[d].type===A)return n[d++].value},m=function(A){var E=p(A);if(E!==void 0)return E;var R=n[d],M=R.type,z=R.index;throw new TypeError("Unexpected ".concat(M," at ").concat(z,", expected ").concat(A))},h=function(){for(var A="",E;E=p("CHAR")||p("ESCAPED_CHAR");)A+=E;return A},g=function(A){for(var E=0,R=a;E<R.length;E++){var M=R[E];if(A.indexOf(M)>-1)return!0}return!1},y=function(A){var E=l[l.length-1],R=A||(E&&typeof E=="string"?E:"");if(E&&!R)throw new TypeError('Must have text between two parameters, missing text after "'.concat(E.name,'"'));return!R||g(R)?"[^".concat(ne(a),"]+?"):"(?:(?!".concat(ne(R),")[^").concat(ne(a),"])+?")};d<n.length;){var b=p("CHAR"),x=p("NAME"),S=p("PATTERN");if(x||S){var v=b||"";i.indexOf(v)===-1&&(f+=v,v=""),f&&(l.push(f),f=""),l.push({name:x||u++,prefix:v,suffix:"",pattern:S||y(v),modifier:p("MODIFIER")||""});continue}var w=b||p("ESCAPED_CHAR");if(w){f+=w;continue}f&&(l.push(f),f="");var P=p("OPEN");if(P){var v=h(),_=p("NAME")||"",C=p("PATTERN")||"",j=h();m("CLOSE"),l.push({name:_||(C?u++:""),pattern:_&&!C?y(v):C,prefix:v,suffix:j,modifier:p("MODIFIER")||""});continue}m("END")}return l}function Hs(e,t){var n=[],r=Un(e,n,t);return Xs(r,n,t)}function Xs(e,t,n){n===void 0&&(n={});var r=n.decode,i=r===void 0?function(s){return s}:r;return function(s){var a=e.exec(s);if(!a)return!1;for(var l=a[0],u=a.index,d=Object.create(null),f=function(m){if(a[m]===void 0)return"continue";var h=t[m-1];h.modifier==="*"||h.modifier==="+"?d[h.name]=a[m].split(h.prefix+h.suffix).map(function(g){return i(g,h)}):d[h.name]=i(a[m],h)},p=1;p<a.length;p++)f(p);return{path:l,index:u,params:d}}}function ne(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function Ln(e){return e&&e.sensitive?"":"i"}function Js(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,i=n.exec(e.source);i;)t.push({name:i[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),i=n.exec(e.source);return e}function Qs(e,t,n){var r=e.map(function(i){return Un(i,t,n).source});return new RegExp("(?:".concat(r.join("|"),")"),Ln(n))}function Ys(e,t,n){return Zs(Bs(e,n),t,n)}function Zs(e,t,n){n===void 0&&(n={});for(var r=n.strict,i=r===void 0?!1:r,s=n.start,a=s===void 0?!0:s,l=n.end,u=l===void 0?!0:l,d=n.encode,f=d===void 0?function(E){return E}:d,p=n.delimiter,m=p===void 0?"/#?":p,h=n.endsWith,g=h===void 0?"":h,y="[".concat(ne(g),"]|$"),b="[".concat(ne(m),"]"),x=a?"^":"",S=0,v=e;S<v.length;S++){var w=v[S];if(typeof w=="string")x+=ne(f(w));else{var P=ne(f(w.prefix)),_=ne(f(w.suffix));if(w.pattern)if(t&&t.push(w),P||_)if(w.modifier==="+"||w.modifier==="*"){var C=w.modifier==="*"?"?":"";x+="(?:".concat(P,"((?:").concat(w.pattern,")(?:").concat(_).concat(P,"(?:").concat(w.pattern,"))*)").concat(_,")").concat(C)}else x+="(?:".concat(P,"(").concat(w.pattern,")").concat(_,")").concat(w.modifier);else{if(w.modifier==="+"||w.modifier==="*")throw new TypeError('Can not repeat "'.concat(w.name,'" without a prefix and suffix'));x+="(".concat(w.pattern,")").concat(w.modifier)}else x+="(?:".concat(P).concat(_,")").concat(w.modifier)}}if(u)i||(x+="".concat(b,"?")),x+=n.endsWith?"(?=".concat(y,")"):"$";else{var j=e[e.length-1],A=typeof j=="string"?b.indexOf(j[j.length-1])>-1:j===void 0;i||(x+="(?:".concat(b,"(?=").concat(y,"))?")),A||(x+="(?=".concat(b,"|").concat(y,")"))}return new RegExp(x,Ln(n))}function Un(e,t,n){return e instanceof RegExp?Js(e,t):Array.isArray(e)?Qs(e,t,n):Ys(e,t,n)}async function ei(e,t,n,r,i=xn()){const s=e.withConfig({apiVersion:Pt});try{const a=new Date(Date.now()+1e3*In),l=`drafts.${i}`,u=zn(),d=s.patch(l).set({secret:u,source:t,studioUrl:n,userId:r});return await s.transaction().createOrReplace({_id:l,_type:wt}).patch(d).commit({tag:kt}),{secret:u,expiresAt:a}}finally{try{await s.delete({query:Ps})}catch(a){console.error("Failed to delete expired secrets",a)}}}function ti(e){const{draftMode:t,previewMode:n,origin:r=typeof location>"u"?"https://localhost":location.origin}=e,i=(n==null?void 0:n.enable)||(t==null?void 0:t.enable);let{preview:s="/"}=e;const a=new URL(s,r),l=i?new URL(i,r):void 0;return async u=>{try{if(u.previewSearchParam){const f=new URL(u.previewSearchParam,a);f.origin===a.origin&&(s=`${f.pathname}${f.search}`)}}catch{}typeof location<"u"&&location.origin===a.origin&&u.studioBasePath&&(s.startsWith(`${u.studioBasePath}/`)||s===u.studioBasePath)&&(s=e.preview||"/");const d=new URL(s,a);if(l){const f=new URL(l),{searchParams:p}=f;return p.set(jt,u.previewUrlSecret),p.set(Et,u.studioPreviewPerspective),d.pathname!==f.pathname&&p.set(St,`${d.pathname}${d.search}`),f.toString()}return d.toString()}}const ni=e=>typeof e=="object"&&typeof e.then=="function",ke=[];function ri(e,t,n=(r,i)=>r===i){if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let i=0;i<r;i++)if(!n(e[i],t[i]))return!1;return!0}function si(e,t=null,n=!1,r={}){t===null&&(t=[e]);for(const s of ke)if(ri(t,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!n)throw s.promise}const i={keys:t,equal:r.equal,remove:()=>{const s=ke.indexOf(i);s!==-1&&ke.splice(s,1)},promise:(ni(e)?e:e(...t)).then(s=>{i.response=s,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(s=>i.error=s)};if(ke.push(i),!n)throw i.promise}const Nn=(e,t,n)=>si(e,t,!1,n);var Q;function ii(e){return{lang:(e==null?void 0:e.lang)??(Q==null?void 0:Q.lang),message:e==null?void 0:e.message,abortEarly:(e==null?void 0:e.abortEarly)??(Q==null?void 0:Q.abortEarly),abortPipeEarly:(e==null?void 0:e.abortPipeEarly)??(Q==null?void 0:Q.abortPipeEarly),skipPipe:e==null?void 0:e.skipPipe}}var Ze;function ai(e){return Ze==null?void 0:Ze.get(e)}var et;function oi(e){return et==null?void 0:et.get(e)}var tt;function ci(e,t){var n;return(n=tt==null?void 0:tt.get(e))==null?void 0:n.get(t)}function Wn(e){var n,r;let t=typeof e;return t==="object"&&(t=(e&&((r=(n=Object.getPrototypeOf(e))==null?void 0:n.constructor)==null?void 0:r.name))??"null"),t==="string"?`"${e}"`:t==="number"||t==="bigint"||t==="boolean"?`${e}`:t}function pe(e,t,n,r,i){const s=i&&"input"in i?i.input:n.value,a=(i==null?void 0:i.expected)??e.expects,l=(i==null?void 0:i.received)??Wn(s),u={kind:e.kind,type:e.type,input:s,expected:a,received:l,message:`Invalid ${t}: ${a?`Expected ${a} but r`:"R"}eceived ${l}`,requirement:e.requirement,path:i==null?void 0:i.path,issues:i==null?void 0:i.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly,skipPipe:r.skipPipe},d=e.kind==="schema",f=e.message??ci(e.reference,u.lang)??(d?oi(u.lang):null)??r.message??ai(u.lang);f&&(u.message=typeof f=="function"?f(u):f),d&&(n.typed=!1),n.issues?n.issues.push(u):n.issues=[u]}function ui(e){return e!=="__proto__"&&e!=="prototype"&&e!=="constructor"}var li=class extends Error{constructor(t){super(t[0].message);Gt(this,"issues");this.name="ValiError",this.issues=t}};function qn(e,t){return{kind:"validation",type:"min_length",reference:qn,async:!1,expects:`>=${e}`,requirement:e,message:t,_run(n,r){return n.typed&&n.value.length<this.requirement&&pe(this,"length",n,r,{received:`${n.value.length}`}),n}}}function di(e,t,n){return typeof e.fallback=="function"?e.fallback(t,n):e.fallback}function pi(e,t){return{...e,fallback:t,_run(n,r){return e._run(n,r),n.issues?{typed:!0,value:di(this,n,r)}:n}}}function hi(e,t,n){return typeof e.default=="function"?e.default(t,n):e.default}function Mt(e){return{kind:"schema",type:"boolean",reference:Mt,expects:"boolean",async:!1,message:e,_run(t,n){return typeof t.value=="boolean"?t.typed=!0:pe(this,"type",t,n),t}}}function le(e,t){return{kind:"schema",type:"object",reference:le,expects:"Object",async:!1,entries:e,message:t,_run(n,r){var s;const i=n.value;if(i&&typeof i=="object"){n.typed=!0,n.value={};for(const a in this.entries){const l=i[a],u=this.entries[a]._run({typed:!1,value:l},r);if(u.issues){const d={type:"object",origin:"value",input:i,key:a,value:l};for(const f of u.issues)f.path?f.path.unshift(d):f.path=[d],(s=n.issues)==null||s.push(f);if(n.issues||(n.issues=u.issues),r.abortEarly){n.typed=!1;break}}u.typed||(n.typed=!1),(u.value!==void 0||a in i)&&(n.value[a]=u.value)}}else pe(this,"type",n,r);return n}}}function Ue(e,...t){const n={kind:"schema",type:"optional",reference:Ue,expects:`${e.expects} | undefined`,async:!1,wrapped:e,_run(r,i){return r.value===void 0&&("default"in this&&(r.value=hi(this,r,i)),r.value===void 0)?(r.typed=!0,r):this.wrapped._run(r,i)}};return 0 in t&&(n.default=t[0]),n}function Fn(e,t){return{kind:"schema",type:"picklist",reference:Fn,expects:e.map(Wn).join(" | ")||"never",async:!1,options:e,message:t,_run(n,r){return this.options.includes(n.value)?n.typed=!0:pe(this,"type",n,r),n}}}function Vn(e,t,n){return{kind:"schema",type:"record",reference:Vn,expects:"Object",async:!1,key:e,value:t,message:n,_run(r,i){var a,l;const s=r.value;if(s&&typeof s=="object"){r.typed=!0,r.value={};for(const u in s)if(ui(u)){const d=s[u],f=this.key._run({typed:!1,value:u},i);if(f.issues){const m={type:"record",origin:"key",input:s,key:u,value:d};for(const h of f.issues)h.path=[m],(a=r.issues)==null||a.push(h);if(r.issues||(r.issues=f.issues),i.abortEarly){r.typed=!1;break}}const p=this.value._run({typed:!1,value:d},i);if(p.issues){const m={type:"record",origin:"value",input:s,key:u,value:d};for(const h of p.issues)h.path?h.path.unshift(m):h.path=[m],(l=r.issues)==null||l.push(h);if(r.issues||(r.issues=p.issues),i.abortEarly){r.typed=!1;break}}(!f.typed||!p.typed)&&(r.typed=!1),f.typed&&(r.value[f.value]=p.value)}}else pe(this,"type",r,i);return r}}}function Ne(e){return{kind:"schema",type:"string",reference:Ne,expects:"string",async:!1,message:e,_run(t,n){return typeof t.value=="string"?t.typed=!0:pe(this,"type",t,n),t}}}function Kn(){return{kind:"schema",type:"unknown",reference:Kn,expects:"unknown",async:!1,_run(e){return e.typed=!0,e}}}function fi(e,t,n){const r=e._run({typed:!1,value:t},ii(n));if(r.issues)throw new li(r.issues);return r.value}function mi(...e){return{...e[0],pipe:e,_run(t,n){for(let r=0;r<e.length;r++){t=e[r]._run(t,n);const i=e[r+1];if(n.skipPipe||t.issues&&(n.abortEarly||n.abortPipeEarly||(i==null?void 0:i.kind)==="schema"||(i==null?void 0:i.kind)==="transformation")){t.typed=!1;break}}return t}}}const gi=/^([A-Za-z]+):([0-9]+)$/,vi=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,yi=/^([A-Za-z]+):([a-z0-9]+)$/;function xi(e){const t=[];for(const n of e.split(".")){const r=gi.exec(n);if(r){t.push(r[1],Number(r[2]));continue}const i=vi.exec(n);if(i){t.push(i[1],[Number(i[2]),Number(i[3])]);continue}const s=yi.exec(n);if(s){t.push(s[1],{_key:s[2]});continue}t.push(n)}return t}const de=mi(Ne(),qn(1)),xe=Ue(de);le({baseUrl:de,dataset:xe,id:de,path:de,projectId:xe,tool:xe,type:xe,workspace:xe,isDraft:Ue(Ne())});le({origin:de,href:de,data:Ue(Vn(Ne(),Kn()))});const bi={"handshake/syn":Rt,"handshake/syn-ack":Tt,"handshake/ack":It,"channel/response":we,"channel/heartbeat":Ae,"channel/disconnect":_t,"overlay/focus":"visual-editing/focus","overlay/navigate":"visual-editing/navigate","overlay/toggle":"visual-editing/toggle","presentation/toggleOverlay":"presentation/toggle-overlay"},wi={[Rt]:"handshake/syn",[Tt]:"handshake/syn-ack",[It]:"handshake/ack",[we]:"channel/response",[Ae]:"channel/heartbeat",[_t]:"channel/disconnect","visual-editing/focus":"overlay/focus","visual-editing/navigate":"overlay/navigate","visual-editing/toggle":"overlay/toggle","presentation/toggle-overlay":"presentation/toggleOverlay"},Pi=e=>{const{data:t}=e;return t&&typeof t=="object"&&"domain"in t&&"type"in t&&"from"in t&&"to"in t&&(t.domain==="sanity/channels"&&(t.domain=Ct),t.to==="overlays"&&(t.to="visual-editing"),t.from==="overlays"&&(t.from="visual-editing"),t.type=bi[t.type]??t.type),e},ji=e=>(e.domain===Ct&&(e.domain="sanity/channels"),e.to==="visual-editing"&&(e.to="overlays"),e.from==="visual-editing"&&(e.from="overlays"),e.type=wi[e.type]??e.type,e.type==="channel/response"&&e.responseTo&&!e.data&&(e.data={responseTo:e.responseTo}),e),Si=({context:e},t)=>{const{sources:n,targetOrigin:r}=e,i=ji(t.message);n.forEach(s=>{s.postMessage(i,{targetOrigin:r})})},pt=()=>({listen:An(Pi),requestMachine:On().provide({actions:{"send message":Si}})});function Ei(e,t){return`${e}-${typeof t=="string"?t:JSON.stringify(t)}`}const ki=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),nn={alt:"altKey",ctrl:"ctrlKey",mod:ki?"metaKey":"ctrlKey",shift:"shiftKey"};function Ci(e,t){return e.every(n=>nn[n]?t[nn[n]]:t.key===n.toUpperCase())}function rn(e){return e.key==="Alt"}function Gn(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>{e.apply(e,r)},t)}}const We=c.createContext(null);We.displayName="PanelsContext";const _i=B.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,Dt=function({children:e,defaultSize:t=null,id:n,minWidth:r,maxWidth:i,order:s=0}){const a=c.useContext(We);if(a===null)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:l,registerElement:u,unregisterElement:d}=a,f=l(n);return c.useLayoutEffect(()=>(u(n,{id:n,type:"panel",defaultSize:t,maxWidth:i??null,minWidth:r??0,order:s}),()=>{d(n)}),[n,t,s,i,r,u,d]),o.jsx(_i,{style:f,children:e})},Bn="presentation/panels",sn=()=>JSON.parse(localStorage.getItem(Bn)||"{}"),Ri=e=>{localStorage.setItem(Bn,JSON.stringify(e))},an=e=>e.map(t=>[t.id,t.order].join(":")).join(",");function Ti(){return c.useMemo(()=>{const e=r=>{const i=sn(),s=an(r);return Array.isArray(i[s])&&i[s].some(a=>a===null)?void 0:i[s]},t=(r,i)=>{const s=sn(),a=an(r),l={...s,[a]:i};Ri(l)},n=Gn(t,100);return{get:e,set:t,setDebounced:n}},[])}function ht(e,t,n){const{maxWidth:r,minWidth:i}=e,s=r==null?100:r/n*100,a=i/n*100;return Math.min(s,Math.max(a,t))}function Ii(e,t,n,r,i,s){const{panels:a,widths:l}=i,{widths:u}=s,d=u||l,f=[...d];{const g=e<0?r:n,y=a.findIndex(S=>S.id===g.id),b=d[y],x=ht(g,b+Math.abs(e),t);if(b===x)return d;e=e<0?b-x:x-b}let p=0,m=e<0?n:r,h=a.findIndex(g=>g.id===m.id);for(;;){const g=a[h],y=d[h],b=Math.abs(e)-Math.abs(p),x=ht(g,y-b,t);if(y!==x&&(p+=y-x,f[h]=x,p.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--h<0)break}else if(++h>=a.length)break}return p===0?d:(m=e<0?r:n,h=a.findIndex(g=>g.id===m.id),f[h]=d[h]+p,f)}function Ai(e,t,n){if(e.length===1)return"100";const r=e.findIndex(s=>s.id===t),i=n[r];return i==null?"0":i.toPrecision(10)}function on(e,t,n=0,r=null){const i=e.clientX,s=(r||t.getBoundingClientRect()).left;return i-s-n}function nt(e){return e.type==="panel"}function cn(e){return e.type==="resizer"}function un(e){return Array.from(e.values()).sort(({order:t},{order:n})=>t==null&&n==null?0:t==null?-1:n==null?1:t-n)}function ln(e,t,n){const r=t.reduce((a,l)=>a+l,0),i=[...t].map(a=>a/r*100);let s=0;for(let a=0;a<e.length;a++){const l=e[a],u=i[a],d=ht(l,u,n);u!=d&&(s+=u-d,i[a]=d)}if(s.toFixed(3)!=="0.000")for(let a=0;a<e.length;a++){const l=e[a];let{maxWidth:u,minWidth:d}=l;d=d/n*100,u!=null&&(u=u/n*100);const f=Math.min(u??100,Math.max(d,i[a]+s));if(f!==i[a]&&(s-=f-i[a],i[a]=f,Math.abs(s).toFixed(3)==="0.000"))break}return i}function Oi(e){let t=e.length,n=100;const r=e.map(s=>s.defaultSize?(n=n-s.defaultSize,t=t-1,s.defaultSize):null),i=n/t;return r.map(s=>s===null?i:s)}const Mi=B.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,Di=function({children:e}){const t=c.useRef(null),[n,r]=c.useState(new Map),i=c.useMemo(()=>un(n).filter(nt),[n]),[s,a]=c.useState([]),[l,u]=c.useState(null),d=c.useRef({elements:n,panels:i,widths:s}),f=c.useCallback(v=>({flexGrow:Ai(i,v,s),pointerEvents:l===null?void 0:"none"}),[l,i,s]),p=c.useCallback((v,w)=>{r(P=>{if(P.has(v))return P;const _=new Map(P);return _.set(v,w),_})},[]),m=c.useCallback(v=>{r(w=>{if(!w.has(v))return w;const P=new Map(w);return P.delete(v),P})},[]),h=c.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),g=c.useCallback((v,w)=>{const P=un(n),_=P.findIndex(A=>A.id===v),C=n.get(v);if(!C||!cn(C))return;const j=C.el.current;j&&(h.current={resizerIndex:_,panelBefore:P.reduce((A,E,R)=>nt(E)&&R<_?E:A,null),panelAfter:P.reduce((A,E,R)=>A===null&&nt(E)&&R>_?E:A,null),containerWidth:window.innerWidth,startX:w.pageX,dragOffset:on(w,j),resizerRect:j.getBoundingClientRect(),widths:d.current.widths},u(v))},[n]),y=c.useCallback(()=>{u(null)},[]),b=c.useCallback((v,w)=>{w.preventDefault(),w.stopPropagation();const{containerWidth:P,dragOffset:_,panelBefore:C,panelAfter:j,resizerRect:A}=h.current;if(C==null||j==null)return;const E=n.get(v);if(!E||!cn(E))return;const R=E.el.current;if(!R)return;const M=on(w,R,_,A);if(M===0)return;const{widths:z}=d.current,D=t.current.getBoundingClientRect(),W=M/D.width*100,V=Ii(W,P,C,j,d.current,h.current);z.some((q,ae)=>q!==V[ae])&&a(V)},[n]);c.useLayoutEffect(()=>{d.current.elements=n,d.current.panels=i,d.current.widths=s},[n,i,s]);const x=Ti();c.useLayoutEffect(()=>{const{widths:v}=d.current;if(v.length===i.length)return;const w=x.get(i);if(w){const _=ln(i,w,window.innerWidth);a(_);return}const P=Oi(i);a(P)},[x,i]),c.useEffect(()=>{s.length&&x.setDebounced(i,s)},[x,i,s]),c.useLayoutEffect(()=>{const v=new ResizeObserver(()=>{const{panels:w,widths:P}=d.current,_=ln(w,P,window.innerWidth);P.some((C,j)=>C!==_[j])&&a(_)});return v.observe(t.current),()=>{v.disconnect()}},[]);const S=c.useMemo(()=>({activeResizer:l,drag:b,getPanelStyle:f,registerElement:p,startDragging:g,stopDragging:y,unregisterElement:m}),[l,b,f,p,g,y,m]);return o.jsx(We.Provider,{value:S,children:o.jsx(Mi,{ref:t,children:e})})};function $t(e){const{children:t,message:n,onRetry:r,onContinueAnyway:i,...s}=e,{t:a}=ee(te),l=o.jsx(H,{fontSize:1,mode:"ghost",onClick:r,text:a("error-card.retry-button.text")}),u=o.jsx(H,{fontSize:1,mode:"ghost",tone:"critical",onClick:i,text:a("error-card.continue-button.text")});return o.jsx(F,{height:"fill",...s,children:o.jsx($,{align:"center",height:"fill",justify:"center",children:o.jsx(zr,{padding:4,sizing:"border",width:0,children:o.jsxs(Y,{space:4,children:[o.jsxs(Y,{space:3,children:[o.jsx(O,{size:1,weight:"semibold",children:a("error-card.title")}),o.jsx(O,{muted:!0,size:1,children:n})]}),t,r&&i?o.jsxs(Lr,{space:2,children:[l,u]}):r?o.jsx(N,{children:l}):i?o.jsx(N,{children:u}):null]})})})})}function $i(e={}){const t=Object.entries(e).map(([n,r])=>`${n}=${r}`).join("&");return t.length?`?${t}`:""}function zi(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"],n=Object.entries(e).filter(([r])=>t.includes(r)).reduce((r,[i,s])=>s==null?r:{...r,[i]:s},{});return $i(n)}const Li=c.forwardRef(function(e,t){const{searchParams:n,...r}=e;return o.jsx(De,{...r,ref:t,state:{type:void 0,_searchParams:Object.entries(n)},title:void 0})}),Ui=c.forwardRef(function(e,t){const{documentId:n,documentType:r,parentRefPath:i,template:s,searchParams:a,...l}=e;return o.jsx(De,{...l,ref:t,state:{id:n,type:r,_searchParams:Object.entries(a)},title:void 0})});function Hn(e){const{children:t,onStructureParams:n,structureParams:r,searchParams:i,refs:s}=e,{state:a,resolvePathFromState:l}=xt(),u=_n(Object.fromEntries(a._searchParams||[])),d=c.useCallback(p=>{const m=l(a),h=zi({...u,...p});return`${m}${h}`},[l,u,a]),f=c.useMemo(()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:r,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:p=>{const{childId:m,...h}=p,g=s==null?void 0:s.find(y=>y._id===m||bt(y._id)===m);return g?o.jsx(De,{...h,state:{id:m,type:g._type,_searchParams:Object.entries(i)}}):o.jsx("div",{...h})},BackLink:p=>o.jsx(Li,{...p,searchParams:i}),ReferenceChildLink:p=>o.jsx(Ui,{...p,searchParams:i}),ParameterizedLink:()=>o.jsx(o.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:p=>{console.warn("handleEditReference",p)},replaceCurrent:p=>{console.warn("replaceCurrent",p)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:p=>{console.warn("duplicateCurrent",p)},setView:p=>{console.warn("setView",p)},setParams:p=>{n({...p,inspect:p.inspect??void 0})},setPayload:p=>{console.warn("setPayload",p)},navigateIntent:(p,m,h)=>{console.warn("navigateIntent",p,m,h)},createPathWithParams:d}),[d,n,s,i,r]);return o.jsx(hs.Provider,{value:f,children:t})}const Ni=B(Cn)`
  height: 100%;
`,Wi=B($)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,qi=B(Ie)`
  white-space: pre-wrap;
`;function Fi(e){const{mainDocumentState:t,onStructureParams:n,searchParams:r,refs:i}=e,{t:s}=ee(te),{devMode:a}=yt(),l=c.useMemo(()=>i.filter(h=>{var g;return bt(h._id)!==((g=t==null?void 0:t.document)==null?void 0:g._id)}).map(h=>h._id),[t,i]),u=c.useMemo(()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:l}},schemaTypeName:"",title:s("document-list-pane.document-list.title"),type:"documentList"}),[l,s]),[d,f]=c.useState(null),p=c.useCallback(()=>f(null),[]),[m]=c.useState(()=>({}));return c.useEffect(()=>f(null),[i]),d?o.jsx($t,{flex:1,message:s("document-list-pane.error.text"),onRetry:p,children:a&&o.jsx(F,{overflow:"auto",padding:3,radius:2,tone:"critical",children:o.jsxs(Y,{space:3,children:[o.jsx(Te,{muted:!0,size:0,children:s("presentation-error.label")}),o.jsx(qi,{size:1,children:d.error.message})]})})}):o.jsx(Rn,{onCatch:f,children:o.jsx(Ni,{children:o.jsx(Tn,{children:o.jsx(Hn,{onStructureParams:n,structureParams:m,searchParams:r,refs:i,children:o.jsx(Wi,{direction:"column",flex:1,children:o.jsx(ls,{index:0,itemId:"$root",pane:u,paneKey:"$root"})})})})})})}const Vi=B(Ie)`
  white-space: pre-wrap;
`;function Ki(e){const{documentId:t,documentType:n,onFocusPath:r,onStructureParams:i,searchParams:s,structureParams:a}=e,{template:l,templateParams:u}=a,{t:d}=ee(te),{devMode:f}=yt(),p=c.useMemo(()=>({id:t,options:{id:t,type:n,template:l,templateParameters:fs(u)},title:"",type:"document"}),[t,n,l,u]),[m,h]=c.useState(null),g=c.useCallback(()=>h(null),[]);return c.useEffect(()=>{h(null)},[t,n,a]),m?o.jsx($t,{flex:1,message:d("document-pane.error.text"),onRetry:g,children:f&&o.jsx(F,{overflow:"auto",padding:3,radius:2,tone:"critical",children:o.jsxs(Y,{space:3,children:[o.jsx(Te,{muted:!0,size:0,children:d("presentation-error.label")}),o.jsx(Vi,{size:1,children:m.error.message})]})})}):o.jsx(Rn,{onCatch:h,children:o.jsx(Cn,{style:{height:"100%"},children:o.jsx(Hn,{searchParams:s,onStructureParams:i,structureParams:a,children:o.jsx(c.Suspense,{fallback:o.jsx(kn,{}),children:o.jsx(ms,{paneKey:"document",index:1,itemId:"document",pane:p,onFocusPath:r})})})})})}function Gi(e){const{documentId:t,documentType:n,onFocusPath:r,onStructureParams:i,searchParams:s,structureParams:a}=e;return o.jsx(Tn,{children:o.jsx(Ki,{documentId:t,documentType:n,onFocusPath:r,onStructureParams:i,searchParams:s,structureParams:a})})}function Bi(e,t){const n=ds(),[r,i]=c.useState({});return c.useEffect(()=>{if(!t)return;const s=ps(n,t,e,"").subscribe(a=>{i(a)});return()=>{s==null||s.unsubscribe()}},[n,t,e]),r}function Hi(e){var y;const{documentId:t,documentType:n,mainDocumentState:r,onFocusPath:i,onStructureParams:s,refs:a,searchParams:l,structureParams:u}=e,{t:d}=ee(te),f=rs(),p=c.useCallback(b=>o.jsx(De,{...b,state:{id:r.document._id,type:r.document._type,_searchParams:Object.entries(l)}}),[r,l]),m=c.useMemo(()=>{var b;return f.get(((b=r==null?void 0:r.document)==null?void 0:b._type)||"shoe")},[r,f]),h=Bi(((y=r==null?void 0:r.document)==null?void 0:y._id)||"",m),g=c.useMemo(()=>r!=null&&r.document?o.jsx(ss,{...is({value:r.document,published:h.published,draft:h.draft}),schemaType:m,status:o.jsx(F,{padding:1,radius:2,shadow:1,children:o.jsx(O,{muted:!0,size:0,weight:"medium",children:d("main-document.label")})})}):null,[r,m,d,h]);return t&&n?o.jsx(Gi,{documentId:t,documentType:n,onFocusPath:i,onStructureParams:s,searchParams:l,structureParams:u}):o.jsxs($,{direction:"column",flex:1,height:"fill",children:[r&&o.jsx(F,{padding:3,tone:r.document?"inherit":"caution",children:r.document?o.jsx(as,{__unstable_focusRing:!0,as:p,"data-as":"a",radius:2,sizing:"border",tone:"inherit",children:g}):o.jsx(F,{padding:2,radius:2,tone:"inherit",children:o.jsxs($,{gap:3,children:[o.jsx(N,{flex:"none",children:o.jsx(O,{size:1,children:o.jsx(os,{})})}),o.jsx(N,{flex:1,children:o.jsx(O,{size:1,children:o.jsx(cs,{t:d,i18nKey:"main-document.missing.text",components:{Code:"code"},values:{path:r.path}})})})]})})}),o.jsx(Fi,{mainDocumentState:r,onStructureParams:s,searchParams:l,refs:a})]})}var U=[];for(var rt=0;rt<256;++rt)U.push((rt+256).toString(16).slice(1));function Xi(e,t=0){return(U[e[t+0]]+U[e[t+1]]+U[e[t+2]]+U[e[t+3]]+"-"+U[e[t+4]]+U[e[t+5]]+"-"+U[e[t+6]]+U[e[t+7]]+"-"+U[e[t+8]]+U[e[t+9]]+"-"+U[e[t+10]]+U[e[t+11]]+U[e[t+12]]+U[e[t+13]]+U[e[t+14]]+U[e[t+15]]).toLowerCase()}var Ce,Ji=new Uint8Array(16);function Qi(){if(!Ce&&(Ce=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ce))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ce(Ji)}var Yi=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),dn={randomUUID:Yi};function Zi(e,t,n){if(dn.randomUUID&&!t&&!e)return dn.randomUUID();e=e||{};var r=e.random||(e.rng||Qi)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Xi(r)}function ea(e){return c.useRef(e||Zi()).current}const ta=B.div`
  position: relative;
`,na=B.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&`
    /* Hover effect */
    & > span:nth-child(2) {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 9px;
      bottom: 0;
      background-color: var(--card-border-color);
      opacity: 0;
      transition: opacity 150ms;
    }

    @media (hover: hover) {
      &:hover > span:nth-child(2) {
        opacity: 0.2;
      }
    }
  `}
`,Xn=function({id:e,order:t,disabled:n=!1}){const r=c.useRef(null),i=c.useContext(We);if(i===null)throw Error("Panel components must be rendered within a PanelGroup container");const s=ea(e),{activeResizer:a,drag:l,startDragging:u,stopDragging:d,registerElement:f,unregisterElement:p}=i,m=a===s;if(i===null)throw Error("Panel components must be rendered within a PanelGroup container");const h=c.useCallback(b=>{u(s,b.nativeEvent)},[s,u]),g=c.useCallback(b=>{l(s,b)},[s,l]),y=c.useCallback(()=>{r.current.blur(),d()},[d]);return c.useEffect(()=>{if(!m||n)return;function b(){const S=document.body.style,v=document.documentElement.style,{cursor:w}=v,{userSelect:P}=S;return v.cursor="ew-resize",S.userSelect="none",()=>{w?v.cursor=w:v.removeProperty("cursor"),P?S.userSelect=P:S.removeProperty("user-select")}}const x=b();return window.addEventListener("mousemove",g),window.addEventListener("mouseup",y),window.addEventListener("contextmenu",y),()=>{x(),window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",y),window.removeEventListener("contextmenu",y)}},[n,m,g,y]),c.useLayoutEffect(()=>(f(s,{id:s,order:t,type:"resizer",el:r}),()=>{p(s)}),[s,t,f,p]),o.jsx(ta,{onMouseDown:h,ref:r,children:o.jsxs(na,{$disabled:n,children:[o.jsx("span",{}),o.jsx("span",{})]})})},ra=e=>{const{documentId:t,setDisplayedDocument:n,getCommentIntent:r}=e;return o.jsxs(o.Fragment,{children:[o.jsx(Xn,{order:4}),o.jsx(Dt,{id:"content",minWidth:325,order:5,children:o.jsx(vs,{documentId:t,setDisplayedDocument:n,children:o.jsx(us,{getIntent:r,children:e.children})})})]})},sa=e=>{const{documentId:t,documentsOnPage:n,documentType:r,getCommentIntent:i,mainDocumentState:s,onFocusPath:a,onStructureParams:l,searchParams:u,setDisplayedDocument:d,structureParams:f}=e;return o.jsx(ra,{documentId:t,getCommentIntent:i,setDisplayedDocument:d,children:o.jsx(Hi,{documentId:t,documentType:r,mainDocumentState:s,onFocusPath:a,onStructureParams:l,refs:n,searchParams:u,structureParams:f})})},ia=function(e){const{children:t,navigate:n}=e,r=c.useCallback((i,s=void 0)=>{n(s||{},i?{preview:i}:{})},[n]);return o.jsx(Zr.Provider,{value:r,children:t})};function aa(e,t){const[n,r]=c.useState(()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t)));return c.useEffect(()=>{localStorage.setItem(e,JSON.stringify(n))},[e,n]),[n,r]}function oa(e){const{unstable_navigator:t}=e,n=!!(t!=null&&t.component),[r,i]=aa("presentation/navigator",n),s=n?r:!1,a=c.useMemo(()=>{if(n)return()=>i(u=>!u)},[n,i]),l=c.useCallback(function(){return o.jsx(o.Fragment,{children:s&&o.jsx(ua,{...t})})},[s,t]);return[{navigatorEnabled:s,toggleNavigator:a},l]}function ca(e){const{minWidth:t,maxWidth:n,component:r}=e,i=t!=null&&n!=null&&t===n;return o.jsxs(o.Fragment,{children:[o.jsx(Dt,{id:"navigator",minWidth:t,maxWidth:n,order:1,children:o.jsx(r,{})}),o.jsx(Xn,{order:2,disabled:i})]})}const ua=c.memo(ca),la=function(e){const{children:t,params:n}=e,r=c.useMemo(()=>n,[n]);return o.jsx(es.Provider,{value:r,children:t})},da=function(e){const{children:t,devMode:n,name:r,navigate:i,params:s,searchParams:a,structureParams:l}=e,u=c.useMemo(()=>({devMode:n,name:r,navigate:i,params:s,searchParams:a,structureParams:l}),[n,r,i,s,a,l]);return o.jsx(ts.Provider,{value:u,children:t})},zt="ACTION_IFRAME_LOADED",ft="ACTION_IFRAME_REFRESH",mt="ACTION_IFRAME_RELOAD",Jn="ACTION_VISUAL_EDITING_OVERLAYS_TOGGLE",pa=(e,t)=>{switch(t.type){case zt:return e.iframe.status==="loaded"?e:{...e,iframe:{...e.iframe,status:"loaded"}};case ft:return e.iframe.status==="refreshing"?e:{...e,iframe:{...e.iframe,status:"refreshing"}};case mt:return e.iframe.status==="reloading"?e:{...e,iframe:{...e.iframe,status:"reloading"}};case Jn:return ha(e,t);default:return e}},ha=(e,t)=>e.visualEditing.overlaysEnabled===t.enabled?e:{...e,visualEditing:{...e.visualEditing,overlaysEnabled:t.enabled}},fa=pi(Mt(),!1),ma=Fn(["loading","loaded","refreshing","reloading"]),ga=le({mainDocument:fa,iframe:le({status:ma}),visualEditing:le({overlaysEnabled:Mt()})}),va={mainDocument:!1,iframe:{status:"loading"},visualEditing:{overlaysEnabled:!1}};function ya(e){return fi(ga,{...va,...e})}const xa=Pe(B.iframe`
  box-shadow: 0 0 0 1px var(--card-border-color);
  border-top: 1px solid transparent;
  border-bottom: 0;
  border-right: 0;
  border-left: 0;
  max-height: 100%;
  width: 100%;
`),ba=B(N)`
  position: absolute;
  inset: 0;
  background: transparent;
`,wa=c.forwardRef(function(e,t){const{animate:n,initial:r,onLoad:i,preventClick:s,src:a,variants:l}=e;return o.jsxs(o.Fragment,{children:[o.jsx(xa,{animate:n,initial:r,onLoad:i,ref:t,src:a,variants:l}),s&&o.jsx(ba,{})]})});function Pa(e){const{openPopup:t,previewLocationOrigin:n,previewLocationRoute:r}=e,{t:i}=ee(te),s=c.useCallback(a=>{a.preventDefault(),t(a.currentTarget.href)},[t]);return o.jsx(ce,{animate:!0,content:o.jsx(O,{size:1,children:i("share-url.menu-item.open.text")}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:o.jsx(H,{as:"a","aria-label":i("share-url.menu-item.open.text"),fontSize:1,icon:Ur,mode:"bleed",padding:2,href:`${n}${r}`,onClick:s,rel:"opener",target:"_blank"})})}const ja=function(e){var v;const{fontSize:t=1,onChange:n,origin:r,padding:i=3,prefix:s,suffix:a,value:l}=e,{t:u}=ee(te),{basePath:d="/"}=((v=En())==null?void 0:v.activeWorkspace)||{},f=c.useRef(null),[p,m]=c.useState(void 0),[h,g]=c.useState(void 0),y=c.useCallback(w=>{m(w.currentTarget.value)},[]),b=c.useCallback(w=>{var P;if(w.key==="Enter"){if(p===void 0)return;const _=p.startsWith("/")||p===""?`${r}${p}`:p;if(!_.startsWith(r+"/")&&_!==r){g(u("preview-location-input.error",{origin:r,context:"missing-origin"}));return}if(!r&&(_.startsWith(`${d}/`)||_===d)){g(u("preview-location-input.error",{basePath:d,context:"same-base-path"}));return}const C=_===r?r+"/":_;g(void 0),m(void 0),n(C.slice(r.length)),(P=f.current)==null||P.blur()}w.key==="Escape"&&(g(void 0),m(void 0))},[d,n,r,p,u]),x=c.useCallback(()=>{g(void 0),m(void 0)},[]);c.useEffect(()=>{g(void 0),m(void 0)},[r,l]);const S=c.useMemo(()=>({icon:Nr}),[]);return o.jsx(o.Fragment,{children:o.jsx(Wr,{clearButton:h?S:void 0,customValidity:h,fontSize:t,onBlur:x,onClear:()=>{g(void 0),m(r+l)},onChange:y,onKeyDownCapture:b,padding:i,prefix:s,style:{zIndex:1},radius:2,ref:f,space:i,suffix:a,value:p===void 0?`${r}${l}`:p})})},Sa=c.lazy(()=>Z(()=>import("./QRCodeSVG-961f62cf.js"),["static/QRCodeSVG-961f62cf.js","static/sanity-66341ca1.js"])),gt=24,Ea=16,ka=224,Ca=B(Kr)`
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: ${gt}px;
  width: ${gt}px;
`,_a=Pe(Re),Ra=Pe(O),Ta=Pe(Ca),Qn=c.memo(function(e){const{canToggleSharePreviewAccess:t,canUseSharedPreviewAccess:n,initialUrl:r,previewLocationRoute:i,perspective:s}=e,{t:a}=ee(te),{push:l}=bn(),u=$e({apiVersion:ze}),d=vt(),[f,p]=c.useState(!0),[m,h]=c.useState(!1),[g,y]=c.useState(!1),[b,x]=c.useState(null),S=m||g||f,v=c.useMemo(()=>b?Fs(r,b,i,s):null,[r,s,i,b]),[w,P]=c.useState(null);if(w)throw w;const _=c.useCallback(()=>{l({closable:!0,status:"warning",title:a("share-preview-menu.error_toggle-sharing",{context:"toggle-sharing"})})},[l,a]),C=c.useCallback(async()=>{try{y(!0),await Ks(u,"@sanity/presentation",typeof window>"u"?"":location.href,d==null?void 0:d.id),x(null)}catch(E){P(E)}finally{y(!1)}},[u,d==null?void 0:d.id]),j=c.useCallback(async()=>{try{h(!0);const E=await Vs(u,"@sanity/presentation",typeof window>"u"?"":location.href,d==null?void 0:d.id);x(E.secret)}catch(E){P(E)}finally{h(!1)}},[u,d==null?void 0:d.id]),A=c.useCallback(()=>{try{if(!v)throw new Error("No URL to copy");navigator.clipboard.writeText(v.toString()),l({closable:!0,status:"success",title:a("share-url.clipboard.status",{context:"success"})})}catch(E){P(E)}},[l,a,v]);return c.useEffect(()=>{let E=new AbortController,R=[];async function M(D,W){const{result:V,syncTags:q}=await u.fetch(ws,{},{filterResponse:!1,lastLiveEventId:D,tag:"presentation.fetch-shared-access-secret"});Array.isArray(q)&&(R=q),W.aborted||x(V)}const z=u.live.events().subscribe({next:D=>{D.type==="message"&&(E.abort(),E=new AbortController,D.tags.some(W=>R.includes(W))&&M(D.id,E.signal))},error:P});return M(null,E.signal).finally(()=>p(!1)),()=>{z.unsubscribe(),E.abort()}},[u]),o.jsx(wn,{button:o.jsx(H,{"aria-label":a("preview-frame.share-button.aria-label"),fontSize:1,icon:Er,mode:"bleed",padding:2}),id:"share-menu",menu:o.jsx(Pn,{style:{maxWidth:248},padding:n?void 0:0,children:n?o.jsxs(o.Fragment,{children:[o.jsx("label",{style:{cursor:"pointer"},children:o.jsxs(kr,{columns:2,rows:2,gapX:3,gapY:1,style:{justifyContent:"center",alignItems:"center",gridTemplateColumns:"min-content 1fr",gridTemplateRows:"min-content"},paddingTop:3,paddingX:3,children:[o.jsx(ce,{animate:!0,content:o.jsx(O,{size:1,children:a("share-preview-menu.toggle-button.tooltip",{context:v?"disable":"enable"})}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:o.jsx(jn,{checked:m||v!==null&&!g,readOnly:m||g,indeterminate:f,onChange:t?v?C:j:_})}),o.jsx(O,{size:1,weight:"medium",children:a("share-preview-menu.toggle-button.label",{context:"first-line"})}),o.jsx("span",{}),o.jsx(O,{muted:!0,size:1,children:a("share-preview-menu.toggle-button.label",{context:"second-line"})})]})}),o.jsx(N,{padding:3,paddingTop:2,children:o.jsxs(Y,{space:3,children:[o.jsx(F,{tone:S||!v?"transparent":void 0,style:{position:"relative",aspectRatio:"1 / 1",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx(Sn,{children:S?o.jsx(_a,{muted:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}):v?o.jsx(o.Fragment,{children:o.jsxs(c.Suspense,{fallback:o.jsx(Re,{}),children:[o.jsx(Sa,{title:a("share-preview-menu.qr-code.title",{url:v.toString()}),value:v.toString(),size:ka,color:"var(--card-fg-color)",logoSize:gt+Ea}),o.jsx(Ta,{initial:{opacity:-.5},animate:{opacity:1.5},exit:{opacity:0}})]})}):o.jsx(Ra,{muted:!0,size:1,style:{maxWidth:"100px",textWrap:"pretty",textAlign:"center"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:a("share-preview-menu.qr-code.placeholder")})})}),o.jsx(O,{muted:!0,size:1,children:a("share-preview-menu.qr-code.instructions")})]})}),o.jsx(Cr,{}),o.jsx(dt,{disabled:!v||g,icon:_r,onClick:A,fontSize:1,padding:3,text:a("share-preview-menu.copy-url.text")})]}):o.jsx(F,{padding:2,tone:"caution",radius:3,children:o.jsx(O,{style:{textWrap:"pretty"},children:a("share-preview-menu.error",{context:"missing-grants"})})})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})});Qn.displayName="Memo(SharePreviewMenu)";const st=Pe($),it={previewDrafts:"preview-frame.perspective.previewDrafts.title",published:"preview-frame.perspective.published.title"},pn={previewDrafts:"caution",published:"positive"},hn={previewDrafts:qr,published:Fr},Yn=c.memo(c.forwardRef(function(e,t){const{canSharePreviewAccess:n,canToggleSharePreviewAccess:r,canUseSharedPreviewAccess:i,dispatch:s,iframe:a,initialUrl:l,loadersConnection:u,navigatorEnabled:d,onPathChange:f,onRefresh:p,openPopup:m,overlaysConnection:h,perspective:g,previewUrl:y,setPerspective:b,setViewport:x,targetOrigin:S,toggleNavigator:v,toggleOverlay:w,viewport:P,visualEditing:{overlaysEnabled:_}}=e,{t:C}=ee(te),{devMode:j}=yt(),A=Rr(),E=c.useRef(null);c.useImperativeHandle(t,()=>E.current);const R=c.useCallback(()=>x(P==="desktop"?"mobile":"desktop"),[x,P]),M=a.status==="loading"||a.status==="reloading",[z,D]=c.useState(!1),W=a.status==="refreshing",[V,q]=c.useState(!1),ae=M||W||h==="connecting",he=c.useMemo(()=>S===location.origin?"":S,[S]),qe=c.useCallback(()=>{p(()=>{E.current&&(s({type:mt}),E.current.src=`${S}${y||"/"}`)})},[s,p,y,S]),fe=c.useCallback(()=>{E.current&&(E.current.src=l.toString(),s({type:mt}))},[s,l]),me=c.useCallback(()=>{je(!0)},[]),[K,je]=c.useState(!1),[X,ge]=c.useState(!1);c.useEffect(()=>{if(!(M||W)&&(h==="connecting"||h==="reconnecting")){const G=setTimeout(()=>{ge(!0)},5e3);return()=>clearTimeout(G)}},[h,M,W]),c.useEffect(()=>{if(!(M||W||!X)){if(h==="connected"&&(q(!1),ge(!1),D(!1),je(!1)),h==="connecting"){const G=setTimeout(()=>{D(!0),console.error("Unable to connect to visual editing. Make sure you've setup '@sanity/visual-editing' correctly")},Ht);return()=>clearTimeout(G)}if(h==="reconnecting"){const G=setTimeout(()=>{D(!0),q(!0)},Ht);return()=>clearTimeout(G)}h==="disconnected"&&q(!0)}},[M,h,W,X]);const se=c.useMemo(()=>{const G=new URL(y||"/",S),{pathname:oe,search:ie}=qs(G);return`${oe}${ie}`},[y,S]),Fe=c.useCallback(()=>{s({type:zt})},[s]);c.useEffect(()=>{if(!E.current)return;const G=E.current;function oe(){G===document.activeElement&&G.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0}))}return window.addEventListener("blur",oe),()=>{window.removeEventListener("blur",oe)}},[]);const ve=c.useMemo(()=>(M||h==="connecting"&&a.status!=="refreshing")&&!K,[K,a.status,M,h]),Ve=c.useMemo(()=>[ve?"background":"active",M?"reloading":"idle",P,X&&!K?"timedOut":""],[K,M,ve,X,P]);return o.jsx(ys,{transition:A?{duration:0}:void 0,children:o.jsxs(Tr,{delay:1e3,children:[o.jsx(F,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:o.jsxs($,{align:"center",style:{minHeight:0},children:[v&&o.jsx(N,{flex:"none",marginRight:1,padding:1,children:o.jsx(ce,{animate:!0,content:o.jsx(O,{size:1,children:C("preview-frame.navigator.toggle-button.tooltip")}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:o.jsx(H,{"aria-label":C("preview-frame.navigator.toggle-button.aria-label"),fontSize:1,icon:Ir,mode:"bleed",onClick:v,padding:2,selected:d})})}),o.jsx(ce,{animate:!0,content:o.jsxs($,{align:"center",style:{whiteSpace:"nowrap"},children:[o.jsx(N,{padding:1,children:o.jsx(O,{size:1,children:C("preview-frame.overlay.toggle-button.tooltip",{context:_?"disable":"enable"})})}),o.jsx(N,{paddingY:1,children:o.jsx(Ar,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:o.jsx(F,{as:"label",flex:"none",marginRight:1,padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:_?"transparent":void 0,children:o.jsxs($,{align:"center",gap:3,children:[o.jsx("div",{style:{margin:-4},children:o.jsx(jn,{checked:_,onChange:w,disabled:a.status==="loading"||h!=="connected"})}),o.jsx(N,{children:o.jsx(O,{muted:!_,size:1,weight:"medium",children:C("preview-frame.overlay.toggle-button.text")})})]})})}),o.jsx(N,{flex:1,marginX:1,children:o.jsx(ja,{prefix:o.jsx(N,{padding:1,children:o.jsx(ce,{animate:!0,content:o.jsx(O,{size:1,children:a.status==="loaded"?C("preview-frame.refresh-button.tooltip"):C("preview-frame.status",{context:a.status})}),fallbackPlacements:["bottom-end"],padding:2,placement:"bottom",portal:!0,children:o.jsx(H,{"aria-label":C("preview-frame.refresh-button.aria-label"),fontSize:1,icon:Or,mode:"bleed",loading:a.status==="reloading"||a.status==="refreshing",onClick:qe,padding:2})})}),onChange:f,origin:he,suffix:o.jsx(N,{padding:1,children:o.jsx(Pa,{openPopup:m,previewLocationOrigin:he,previewLocationRoute:se})}),value:se})}),o.jsx($,{align:"center",flex:"none",gap:1,padding:1,children:o.jsx(wn,{button:o.jsx(H,{fontSize:1,iconRight:Mr,mode:"bleed",padding:2,space:2,text:C(it[u==="connected"?g:"previewDrafts"]),loading:u==="reconnecting"&&a.status!=="loaded",disabled:u!=="connected"}),id:"perspective-menu",menu:o.jsxs(Pn,{style:{maxWidth:240},children:[o.jsx(dt,{fontSize:1,onClick:()=>b("previewDrafts"),padding:3,pressed:g==="previewDrafts",tone:pn.previewDrafts,children:o.jsxs($,{align:"flex-start",gap:3,children:[o.jsx(N,{flex:"none",children:o.jsx(O,{size:1,children:c.createElement(hn.previewDrafts)})}),o.jsxs(Y,{flex:1,space:2,children:[o.jsx(O,{size:1,weight:"medium",children:C(it.previewDrafts)}),o.jsx(O,{muted:!0,size:1,children:C("preview-frame.perspective.previewDrafts.text")})]}),o.jsx(N,{flex:"none",children:o.jsx(O,{muted:!0,size:1,style:{opacity:g==="previewDrafts"?1:0},children:o.jsx(Xt,{})})})]})}),o.jsx(dt,{fontSize:1,onClick:()=>b("published"),padding:3,pressed:g==="published",tone:pn.published,children:o.jsxs($,{align:"flex-start",gap:3,children:[o.jsx(N,{flex:"none",children:o.jsx(O,{size:1,children:c.createElement(hn.published)})}),o.jsxs(Y,{flex:1,space:2,children:[o.jsx(O,{size:1,weight:"medium",children:C(it.published)}),o.jsx(O,{muted:!0,size:1,children:C("preview-frame.perspective.published.text")})]}),o.jsx(N,{flex:"none",children:o.jsx(O,{muted:!0,size:1,style:{opacity:g==="published"?1:0},children:o.jsx(Xt,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),o.jsx($,{align:"center",flex:"none",gap:1,children:o.jsx(ce,{animate:!0,content:o.jsx(O,{size:1,children:C("preview-frame.viewport-button.tooltip",{context:P==="desktop"?"narrow":"full"})}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:o.jsx(H,{"aria-label":C("preview-frame.viewport-button.aria-label"),fontSize:1,icon:P==="desktop"?Dr:$r,mode:"bleed",onClick:R,padding:2})})}),n&&o.jsx($,{align:"center",flex:"none",gap:1,paddingX:1,children:o.jsx(Qn,{canToggleSharePreviewAccess:r,canUseSharedPreviewAccess:i,previewLocationRoute:se,initialUrl:l,perspective:g})})]})}),o.jsx(F,{flex:1,tone:"transparent",children:o.jsxs($,{align:"center",height:"fill",justify:"center",padding:P==="desktop"?0:2,sizing:"border",style:{position:"relative",cursor:ae?"wait":void 0},children:[o.jsx(Sn,{children:!V&&!M&&!W&&X&&!K?o.jsx(st,{initial:"initial",animate:"animate",exit:"exit",variants:fn,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:z?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:z?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:o.jsxs($,{style:{...Me[P]},justify:"center",align:"center",direction:"column",gap:4,children:[z&&o.jsx(H,{disabled:!0,fontSize:1,mode:"ghost",text:C("preview-frame.continue-button.text"),style:{opacity:0}}),o.jsx(F,{radius:2,tone:z?"caution":"inherit",padding:4,shadow:1,children:o.jsxs($,{justify:"center",align:"center",direction:"column",gap:4,children:[o.jsx(Re,{muted:!0}),o.jsx(O,{muted:!0,size:1,children:z?C("preview-frame.status",{context:"timeout"}):C("preview-frame.status",{context:"connecting"})})]})}),z&&o.jsx(H,{fontSize:1,tone:"critical",onClick:me,text:C("preview-frame.continue-button.text")})]})}):(M||h==="connecting"&&a.status!=="refreshing")&&!K?o.jsx(st,{initial:"initial",animate:"animate",exit:"exit",variants:fn,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:o.jsxs($,{style:{...Me[P]},justify:"center",align:"center",direction:"column",gap:4,children:[o.jsx(Re,{muted:!0}),o.jsx(O,{muted:!0,size:1,children:C("preview-frame.status",{context:"loading"})})]})}):V&&!K?o.jsx(st,{initial:"initial",animate:"animate",exit:"exit",variants:Ia,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:o.jsx($t,{flex:1,message:C("preview-frame.connection.error.text"),onRetry:fe,onContinueAnyway:me,children:j&&o.jsxs(o.Fragment,{children:[h!=="connected"&&o.jsx(F,{padding:3,radius:2,tone:"critical",children:o.jsxs(Y,{space:3,children:[o.jsx(Te,{muted:!0,size:0,children:C("preview-frame.overlay.connection-status.label")}),o.jsx(Ie,{size:1,children:C("channel.status",{context:h})})]})}),u!=="connected"&&o.jsx(F,{padding:3,radius:2,tone:"critical",children:o.jsxs(Y,{space:3,children:[o.jsx(Te,{muted:!0,size:0,children:C("preview-frame.loader.connection-status.label")}),o.jsx(Ie,{size:1,children:C("channel.status",{context:u})})]})})]})})}):null}),o.jsx(wa,{animate:Ve,initial:["background"],onLoad:Fe,preventClick:ve,ref:E,src:l.toString(),variants:Aa})]})})]})})}));Yn.displayName="Memo(ForwardRef(PreviewFrame))";const Me={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},fn={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Ia={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Aa={desktop:{...Me.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...Me.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function Oa(e,t,n,r,i){const s=c.useRef(r),a=c.useCallback(t,n);c.useEffect(()=>{const l=s.current;if(s.current=e,e!==l)return a(e,l)},[a,i,e])}const Ma=function(e){const{documentId:t,documentType:n,navigate:r,perspective:i,documentRevision:s}=e,a=ns(t,n);return Oa(i,l=>{let u;if(l==="published"&&a.published){const{_updatedAt:d,_rev:f}=a.published;u=`${d}/${f}`}s!==u&&r({},{rev:u},!0)},[a,r,s]),null};let mn=!1;function Da(e,t){if(e!=="published"&&e!=="previewDrafts")throw new Error(`Invalid perspective: ${e}`);const[n,r]=c.useState({}),[i,s]=c.useState({}),a=c.useRef(""),l=c.useCallback((u,d,f=[])=>{const p=f.filter(m=>"_projectId"in m&&m._projectId?(mn||(console.warn("Cross dataset references are not supported yet, ignoring source document",m),mn=!0),!1):m);(d==="published"?r:s)(m=>{const h={};for(const y of p)h[y._id]=y;if(a.current!==t.current.url)return a.current=t.current.url,{[u]:h};const g=m[u];return gs(g,h)?m:{...m,[u]:h}})},[t]);return[c.useMemo(()=>{const u=Object.values(e==="published"?n:i).reduce((d,f)=>(Object.values(f).forEach(p=>{d[p._id]=p}),d),{});return Object.values(u)},[e,i,n]),l]}function Zn(e,t){return e instanceof Function?e(t):e}function $a(e,t){var n;if(e.resolve){const r=(n=e.resolve(t))==null?void 0:n.filter;return r?`*[${r}][0]{_id, _type}`:void 0}return"type"in e?`*[_type == "${e.type}"][0]{_id, _type}`:`*[${Zn(e.filter,t)}][0]{_id, _type}`}function za(e,t){var n;return e.resolve?((n=e.resolve(t))==null?void 0:n.params)??t.params:"type"in e?{}:Zn(e.params,t)??t.params}function La(e,t){const n=Array.isArray(e)?e:[e];for(e of n){let r,i=e;if(typeof e=="string")try{const s=new URL(e);r=s.origin,i=s.pathname}catch{}if(!(r&&t.origin!==r))try{const s=Hs(i,{decode:decodeURIComponent})(t.pathname);if(s){const{params:a,path:l}=s;return{origin:r,params:a,path:l}}}catch{throw new Error(`"${e}" is not a valid route pattern`)}}}function Ua(e){const{navigate:t,navigationHistory:n,path:r,previewUrl:i,resolvers:s=[]}=e,{state:a}=xt(),l=$e({apiVersion:ze}),[u,d]=c.useState(void 0),f=c.useRef(void 0),p=c.useMemo(()=>{var y,b;const h=r||((b=(y=a._searchParams)==null?void 0:y.find(([x])=>x==="preview"))==null?void 0:b[1])||"",g=typeof i=="string"?i:typeof i=="object"&&(i==null?void 0:i.origin)||location.origin;return new URL(h,g)},[r,i,a._searchParams]),m=c.useCallback(()=>{d(void 0),f.current=void 0},[]);return c.useEffect(()=>{if(s.length&&p){let h;for(const g of s){const y=La(g.route,p);if(y){h={context:y,resolver:g};break}}if(h){const g=$a(h.resolver,h.context),y=za(h.resolver,h.context);if(g){const b=new AbortController,x={perspective:"previewDrafts",signal:b.signal};return l.fetch(g,y,x).then(S=>{var v,w;(!S||f.current!==S._id)&&(d({document:S,path:p.pathname}),f.current=S==null?void 0:S._id,((v=n.at(-1))==null?void 0:v.id)===((w=n.at(-2))==null?void 0:w.id)&&(t==null||t({id:S==null?void 0:S._id,type:S==null?void 0:S._type})))}).catch(S=>{S instanceof Error&&S.name==="AbortError"||(d({document:void 0,path:p.pathname}),f.current=void 0)}),()=>{b.abort()}}}}m()},[l,m,t,n,s,p]),u}function Na(e){var n;if(e===void 0)return;const t=(n=decodeURIComponent(e))==null?void 0:n.split(".");return t[0]==="drafts"&&t.shift(),t.join(".")}function Wa(e){if(e!==void 0)return $n.toString(xi(decodeURIComponent(e)))}function qa(e){return{id:Na(e.id),path:Wa(e.path),type:e.type}}function _e(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0&&t!==""&&t!==null))}function Fa({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:r,frameStateRef:i}){const s=c.useMemo(()=>{const{id:p,path:m,type:h}=qa(n);return{id:p,type:h,path:m,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,viewport:r.viewport,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,templateParams:r.templateParams,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}},[n,r,e]),a=c.useMemo(()=>_e({inspect:s.inspect,path:s.path,rev:s.rev,since:s.since,template:s.template,templateParams:s.templateParams,view:s.view,pathKey:s.pathKey,instruction:s.instruction,comment:s.comment}),[s.comment,s.inspect,s.instruction,s.path,s.pathKey,s.rev,s.since,s.template,s.templateParams,s.view]),l=c.useMemo(()=>_e({perspective:s.perspective,preview:s.preview,viewport:s.viewport}),[s.perspective,s.preview,s.viewport]),u=c.useRef(n);c.useEffect(()=>{u.current=n},[n]);const[d,f]=c.useState([n]);return{navigate:c.useCallback((p,m={},h)=>{p.id&&(p.id=bt(p.id));const{_searchParams:g,...y}=u.current,b=(g||[]).reduce((w,[P,_])=>(w[P]=_,w),{}),x=_e({...y,...p}),S=_e({...b,...m});y.id!==x.id&&(delete S.template,delete S.templateParams),x._searchParams=Object.entries(S).reduce((w,[P,_])=>[...w,[P,_]],[]);const v=h??S.preview===i.current.url;f(w=>[...w,x]),t(x,{replace:v})},[t,i]),navigationHistory:d,params:s,searchParams:l,structureParams:a}}function Va(e,t,n,r,i){var p,m;const s=$e({apiVersion:ze}),a=En(),l=((p=a==null?void 0:a.activeWorkspace)==null?void 0:p.basePath)||"/",u=((m=a==null?void 0:a.activeWorkspace)==null?void 0:m.name)||"default",d=Ga(t,l,u,r),f=Ba(i&&typeof e=="object"||typeof e=="function",d);return Nn(async()=>{if(typeof e=="string"){const g=new URL(e,location.origin);let y=g;try{if(r){const b=new URL(r,g);b.origin===g.origin&&(y=b)}}catch{}return location.origin===y.origin&&(y.pathname.startsWith(`${l}/`)||y.pathname===l)?g:y}const h=await(typeof e=="object"?ti(e):e)({client:s,previewUrlSecret:f,studioPreviewPerspective:n,previewSearchParam:r,studioBasePath:l});return new URL(h,location.origin)},[...d,f])}const Ka=Symbol();function Ga(e,t,n,r){const[i,s]=c.useState(()=>r||""),a=c.useRef(0);c.useEffect(()=>{if(i&&r)return window.clearTimeout(a.current),()=>{a.current=window.setTimeout(()=>{s("")},100)}},[i,r]);const l=vt();return c.useMemo(()=>["@sanity/presentation",t,n,e,l==null?void 0:l.id,Ka,i],[t,l==null?void 0:l.id,e,n,i])}function Ba(e,t){const n=$e({apiVersion:ze}),r=vt(),[i,s]=c.useState(""),a=e?Nn(async()=>await ei(n,"@sanity/presentation",typeof window>"u"?"":location.href,r==null?void 0:r.id),[...t,i]):null;return c.useEffect(()=>{if(!a)return;const l=setTimeout(()=>{c.startTransition(()=>s(a.expiresAt.toString()))},a.expiresAt.getTime()-Date.now());return()=>clearTimeout(l)},[a]),(a==null?void 0:a.secret)||null}function at(){const[e,t]=c.useState(new Map),n=c.useMemo(()=>{const i=Array.from(e.values()),s=i.filter(({status:a})=>a==="handshaking");return s.length?s.some(({hasConnected:a})=>!a)?"connecting":"reconnecting":i.find(({status:a})=>a==="connected")?"connected":"idle"},[e]),r=c.useCallback(i=>{t(s=>{var l;const a=new Map(s);if(i.status==="disconnected")a.delete(i.channel);else{const u=((l=a.get(i.channel))==null?void 0:l.hasConnected)||i.status==="connected";a.set(i.channel,{status:i.status,hasConnected:u})}return a})},[]);return[n,r]}const Ha=c.lazy(()=>Z(()=>import("./LoaderQueries-8d6d9474.js"),["static/LoaderQueries-8d6d9474.js","static/sanity-66341ca1.js","static/hooks-f90cb2cd.js","static/DisplayedDocumentBroadcaster-7ca8062e.js"]));c.lazy(()=>Z(()=>import("./LiveQueries-71f1272f.js"),["static/LiveQueries-71f1272f.js","static/sanity-66341ca1.js","static/hooks-f90cb2cd.js","static/DisplayedDocumentBroadcaster-7ca8062e.js"]));const Xa=c.lazy(()=>Z(()=>import("./PostMessageDocuments-f462c19b.js"),["static/PostMessageDocuments-f462c19b.js","static/sanity-66341ca1.js"])),Ja=c.lazy(()=>Z(()=>import("./PostMessageFeatures-cda719fd.js"),["static/PostMessageFeatures-cda719fd.js","static/sanity-66341ca1.js"])),Qa=c.lazy(()=>Z(()=>import("./PostMessageRefreshMutations-f29b8065.js"),["static/PostMessageRefreshMutations-f29b8065.js","static/sanity-66341ca1.js"])),Ya=c.lazy(()=>Z(()=>import("./PostMessagePerspective-2b2b786f.js"),["static/PostMessagePerspective-2b2b786f.js","static/sanity-66341ca1.js"])),Za=c.lazy(()=>Z(()=>import("./PostMessagePreviewSnapshots-f4748917.js"),["static/PostMessagePreviewSnapshots-f4748917.js","static/sanity-66341ca1.js"])),eo=c.lazy(()=>Z(()=>import("./PostMessageSchema-712def17.js"),["static/PostMessageSchema-712def17.js","static/sanity-66341ca1.js"])),to=B($)`
  overflow-x: auto;
`;function no(e){var Wt,qt,Ft,Vt,Kt;const{canCreateUrlPreviewSecrets:t,canToggleSharePreviewAccess:n,canUseSharedPreviewAccess:r,tool:i}=e,s=(Wt=i.options)==null?void 0:Wt.components,a=(qt=i.options)==null?void 0:qt.previewUrl,l=i.name||Gr,{unstable_navigator:u}=s||{},{navigate:d,state:f}=xt(),p=_n(Object.fromEntries(f._searchParams||[])),m=Va(a||"/",l,p.perspective==="published"?"published":"previewDrafts",p.preview||null,t),h=c.useMemo(()=>a&&typeof a=="object"&&"previewMode"in a&&a.previewMode?a.previewMode.shareAccess!==!1:!1,[a]),[g]=c.useState(()=>{var T;const k=(T=i.options)==null?void 0:T.devMode;return typeof k=="function"?k():typeof k=="boolean"?k:typeof window<"u"&&window.location.hostname==="localhost"}),y=c.useMemo(()=>m.origin,[m.origin]),b=c.useRef(null),[x,S]=c.useState(),[v,w]=c.useState(null),P=c.useRef({title:void 0,url:void 0}),{navigate:_,navigationHistory:C,params:j,searchParams:A,structureParams:E}=Fa({initialPreviewUrl:m,routerNavigate:d,routerState:f,routerSearchParams:p,frameStateRef:P}),R=c.useMemo(()=>Gn(_,50),[_]),[M,z]=c.useReducer(pa,{},ya),D=c.useMemo(()=>j.perspective?"published":"previewDrafts",[j.perspective]),W=c.useMemo(()=>j.viewport?"mobile":"desktop",[j.viewport]),[V,q]=Da(D,P),ae=Br(),he=Hr(),qe=Ua({navigate:_,navigationHistory:C,path:j.preview,previewUrl:(Ft=i.options)==null?void 0:Ft.previewUrl,resolvers:(Kt=(Vt=i.options)==null?void 0:Vt.resolve)==null?void 0:Kt.mainDocuments}),[fe,me]=at(),[K,je]=at(),[X,ge]=at(),[se,Fe]=c.useState(()=>new Set),ve=c.useCallback(k=>{const T=window.open(k,"_blank");T&&Fe(I=>new Set(I).add(T))},[]);c.useEffect(()=>{var I;const k=(I=b.current)==null?void 0:I.contentWindow;if(!k||M.iframe.status==="loading")return;const T=Ts({targetOrigin:y});return T.addTarget(k),S(T),()=>{T.destroy(),S(void 0)}},[y,M.iframe.status]),c.useEffect(()=>{const k=[];if(se.size&&x)for(const T of se)T&&"closed"in T&&!T.closed&&k.push(x.addTarget(T));return()=>{k.forEach(T=>T())}},[x,se]),c.useEffect(()=>{if(!x)return;const k=x.createConnection({name:"presentation",heartbeat:!0,connectTo:"visual-editing"},Oe().provide({actors:pt()}));k.on("visual-editing/focus",I=>{"id"in I&&R({type:I.type,id:I.id,path:I.path})}),k.on("visual-editing/navigate",I=>{const{title:lr,url:Ge}=I;P.current.url!==Ge&&R({},{preview:Ge}),P.current={title:lr,url:Ge}}),k.on("visual-editing/meta",I=>{P.current.title=I.title}),k.on("visual-editing/toggle",I=>{z({type:Jn,enabled:I.enabled})}),k.on("visual-editing/documents",I=>{q("visual-editing",I.perspective,I.documents)}),k.on("visual-editing/refreshing",I=>{I.source==="manual"?clearTimeout(Ut.current):I.source==="mutation"&&z({type:ft})}),k.on("visual-editing/refreshed",()=>{z({type:zt})}),k.onStatus(me);const T=k.start();return w(k),()=>{T(),w(null)}},[x,R,q,me,y]),c.useEffect(()=>{if(!x)return;const k=x.createConnection({name:"presentation",connectTo:"preview-kit",heartbeat:!0},Oe().provide({actors:pt()}));return k.onStatus(ge),k.on("preview-kit/documents",T=>{T.projectId===ae&&T.dataset===he&&q("preview-kit",T.perspective,T.documents)}),k.start()},[x,he,ae,q,ge,y]);const Ve=c.useCallback(k=>{R({path:$n.toString(k)},{},!0)},[R]),G=c.useCallback(k=>{const T=new URL(k,m.origin),I=T.pathname+T.search;T.origin===m.origin&&I!==j.preview&&R({},{preview:I})},[m,j,R]),oe=c.useCallback(k=>{R({},k)},[R]);c.useEffect(()=>{j.id&&j.path?v==null||v.post({type:"presentation/focus",data:{id:j.id,path:j.path}}):v==null||v.post({type:"presentation/blur",data:void 0})},[j.id,j.path,v]),c.useEffect(()=>{P.current.url&&j.preview&&P.current.url!==j.preview&&(P.current.url=j.preview,fe!=="connected"&&b.current?b.current.src=`${y}${j.preview}`:v==null||v.post({type:"presentation/navigate",data:{url:j.preview,type:"replace"}}))},[fe,y,j.preview,v]);const ie=c.useCallback(()=>v==null?void 0:v.post({type:"presentation/toggle-overlay",data:void 0}),[v]),[er,tr]=c.useState(null);c.useEffect(()=>{const k=I=>{rn(I)&&ie()},T=I=>{rn(I)&&ie(),Ci(["mod","\\"],I)&&ie()};return window.addEventListener("keydown",T),window.addEventListener("keyup",k),()=>{window.removeEventListener("keydown",T),window.removeEventListener("keyup",k)}},[ie]);const[nr,rr]=c.useState(null),[{navigatorEnabled:Lt,toggleNavigator:sr},ir]=oa({unstable_navigator:u}),Ke=c.useRef(j.id);c.useEffect(()=>{j.rev&&Ke.current&&j.id!==Ke.current&&R({},{rev:void 0}),Ke.current=j.id});const Ut=c.useRef(),ar=c.useCallback(k=>{if(z({type:ft}),v){Ut.current=window.setTimeout(k,300),v.post({type:"presentation/refresh",data:{source:"manual",livePreviewEnabled:X==="connected"||K==="connected"}});return}k()},[K,X,v]),Nt=Xr(),or=c.useCallback(({id:k,type:T,path:I})=>{if(P.current.url)return{title:P.current.title||P.current.url,name:"edit",params:{id:k,path:I,type:T,inspect:Jr,workspace:Nt.name,mode:Qr,preview:j.preview}}},[j.preview,Nt.name]),cr=c.useCallback(k=>{R({},{viewport:k==="desktop"?void 0:"mobile"},!0)},[R]),ur=c.useCallback(k=>{R({},{perspective:k==="previewDrafts"?void 0:k})},[R]);return o.jsxs(o.Fragment,{children:[o.jsx(da,{devMode:g,name:l,navigate:R,params:j,searchParams:A,structureParams:E,children:o.jsx(ia,{navigate:R,children:o.jsx(la,{params:j,children:o.jsx(to,{height:"fill",children:o.jsxs(Di,{children:[o.jsx(ir,{}),o.jsx(Dt,{id:"preview",minWidth:325,defaultSize:Lt?50:75,order:3,children:o.jsx($,{direction:"column",flex:1,height:"fill",ref:rr,children:o.jsx(Yr,{element:nr,children:o.jsx(Yn,{canSharePreviewAccess:h,canToggleSharePreviewAccess:n,canUseSharedPreviewAccess:r,dispatch:z,iframe:M.iframe,initialUrl:m,loadersConnection:K,navigatorEnabled:Lt,onPathChange:G,onRefresh:ar,openPopup:ve,overlaysConnection:fe,previewUrl:j.preview,perspective:D,ref:b,setPerspective:ur,setViewport:cr,targetOrigin:y,toggleNavigator:sr,toggleOverlay:ie,viewport:W,visualEditing:M.visualEditing})})})}),o.jsx(sa,{documentId:j.id,documentsOnPage:V,documentType:j.type,getCommentIntent:or,mainDocumentState:qe,onFocusPath:Ve,onStructureParams:oe,searchParams:A,setDisplayedDocument:tr,structureParams:E})]})})})})}),x&&o.jsx(c.Suspense,{children:o.jsx(Ha,{controller:x,perspective:D,liveDocument:er,onDocumentsOnPage:q,onLoadersConnection:je,documentsOnPage:V})}),v&&j.id&&j.type&&o.jsx(c.Suspense,{children:o.jsx(Qa,{comlink:v,id:j.id,type:j.type,loadersConnection:K,previewKitConnection:X})}),v&&o.jsx(c.Suspense,{children:o.jsx(eo,{comlink:v,perspective:D})}),v&&V.length>0&&o.jsx(c.Suspense,{children:o.jsx(Za,{comlink:v,perspective:D,refs:V})}),v&&o.jsx(c.Suspense,{children:o.jsx(Xa,{comlink:v})}),v&&o.jsx(c.Suspense,{children:o.jsx(Ja,{comlink:v})}),v&&o.jsx(c.Suspense,{children:o.jsx(Ya,{comlink:v,perspective:D})}),j.id&&j.type&&o.jsx(Ma,{documentId:j.id,documentRevision:j.rev,documentType:j.type,navigate:R,perspective:D})]})}function ro(e){const{t}=ee(te),{previewUrl:n}=e.tool.options??{},{push:r}=bn(),i=typeof n=="object"||typeof n=="function",s=Vr(),[a,l]=c.useState(null),[u,d]=c.useState(null),[f,p]=c.useState(null),[m,h]=c.useState(null);c.useEffect(()=>{if(!i)return;const y=s.checkDocumentPermission("create",{_id:re,_type:ue}).subscribe(l),b=s.checkDocumentPermission("update",{_id:re,_type:ue}).subscribe(d),x=s.checkDocumentPermission("read",{_id:re,_type:ue}).subscribe(p),S=s.checkDocumentPermission("create",{_id:`drafts.${xn()}`,_type:wt}).subscribe(h);return()=>{y.unsubscribe(),b.unsubscribe(),x.unsubscribe(),S.unsubscribe()}},[s,i]);const g=m==null?void 0:m.granted;return c.useEffect(()=>{if(!i||g!==!1)return;const y=requestAnimationFrame(()=>r({closable:!0,status:"error",duration:3e4,title:t("preview-url-secret.missing-grants")}));return()=>cancelAnimationFrame(y)},[g,r,t,i]),i&&(!a||typeof a.granted>"u"||!u||typeof u.granted>"u"||!m||!f||typeof f.granted>"u"||typeof m.granted>"u")?o.jsx(kn,{}):o.jsx(no,{...e,canCreateUrlPreviewSecrets:g===!0,canToggleSharePreviewAccess:(a==null?void 0:a.granted)===!0&&(u==null?void 0:u.granted)===!0,canUseSharedPreviewAccess:(f==null?void 0:f.granted)===!0})}var so=Object.freeze({__proto__:null,default:ro});const po=Object.freeze(Object.defineProperty({__proto__:null,PresentationToolGrantsCheck:so,createCompatibilityActors:pt,getQueryCacheKey:Ei},Symbol.toStringTag,{value:"Module"}));export{Yt as D,Oe as N,po as P,co as a,Os as b,pt as c,Ei as g,uo as p,lo as r,Ms as t,Ye as w};
